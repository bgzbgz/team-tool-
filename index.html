<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Track - Team Dysfunction Assessment | Sprint 5 of 32</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @font-face {
            font-family: 'Plaak';
            src: url('Plaak3Trial-43-Bold.otf') format('opentype');
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Riforma';
            src: url('RiformaLL-Regular.otf') format('opentype');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        
        :root {
            --black: #000000;
            --white: #FFFFFF;
            --grey-50: #F9FAFB;
            --grey-100: #F3F4F6;
            --grey-200: #E5E7EB;
            --grey-300: #D1D5DB;
            --grey-400: #9CA3AF;
            --grey-500: #6B7280;
            --grey-600: #4B5563;
            --grey-700: #374151;
            --grey-800: #1F2937;
            --grey-900: #111827;
            --yellow-50: #fffef5;
            --yellow-100: #fffde6;
            --yellow-200: #fffacc;
            --yellow-300: #fff7a3;
            --yellow-400: #fff469;
            --yellow-500: #f0e55a;
            --yellow-600: #d4c94f;
            --yellow-700: #a89e3e;
            --green: #10B981;
            --amber: #F59E0B;
            --red: #EF4444;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Riforma', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--white);
            color: var(--black);
            line-height: 1.7;
            font-size: 14px;
        }
        
        h1, h2, h3, h4, .heading {
            font-family: 'Plaak', Arial, sans-serif;
            font-weight: 700;
            line-height: 1.3;
        }
        
        h1 { font-size: 36px; }
        h2 { font-size: 28px; }
        h3 { font-size: 20px; letter-spacing: -0.01em; }
        h4 { font-size: 16px; }
        
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 32px 24px;
        }
        
        /* Icons */
        .icon { display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .icon svg { stroke-width: 2; }
        .icon-sm svg { width: 16px; height: 16px; }
        .icon-md svg { width: 20px; height: 20px; }
        .icon-lg svg { width: 24px; height: 24px; }
        
        /* Header */
        .header {
            background: var(--black);
            color: var(--white);
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 960px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .sprint-badge {
            font-size: 13px;
            color: var(--grey-400);
        }
        
        .sprint-badge strong {
            color: var(--yellow-400);
        }
        
        .ftp-display {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .ftp-display .icon { color: var(--yellow-400); }
        
        .logo {
            background: var(--white);
            padding: 8px 12px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo img {
            height: 28px;
            width: auto;
            display: block;
        }
        
        /* Tabs */
        .tabs-nav {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--grey-200);
            margin-bottom: 40px;
        }
        
        .tab-btn {
            padding: 16px 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-family: 'Riforma', sans-serif;
            font-weight: 400;
            font-size: 14px;
            color: var(--grey-500);
            transition: color 0.2s;
            border-bottom: 3px solid transparent;
            margin-bottom: -1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn:hover:not(:disabled) {
            color: var(--grey-700);
        }
        
        .tab-btn.active {
            color: var(--black);
            border-bottom-color: var(--yellow-400);
        }
        
        .tab-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .tab-btn .icon { color: inherit; }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Cards */
        .card {
            background: var(--white);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            padding: 32px;
            margin-bottom: 32px;
        }
        
        .card-yellow {
            border-color: var(--yellow-300);
            background: var(--yellow-50);
        }
        
        .card h3 {
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card h3 .icon { color: var(--grey-600); }
        
        /* Reference Slides */
        .ref-slide {
            display: none;
            min-height: calc(100vh - 200px);
            align-items: center;
            justify-content: center;
        }
        
        .ref-slide.active {
            display: flex;
        }
        
        .slide-container {
            max-width: 700px;
            width: 100%;
            text-align: center;
            padding: 40px 24px;
        }
        
        .slide-badge {
            width: 80px;
            height: 80px;
            background: var(--yellow-400);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 32px;
        }
        
        .slide-badge.warning {
            background: var(--red);
            color: white;
        }
        
        .slide-badge .icon {
            color: var(--black);
        }
        
        .slide-badge.warning .icon {
            color: white;
        }
        
        .slide-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--black);
        }
        
        .slide-subtitle {
            font-size: 14px;
            color: var(--grey-500);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .slide-description {
            font-size: 18px;
            color: var(--grey-600);
            line-height: 1.6;
            margin-bottom: 40px;
        }
        
        .scope-grid-slide {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 48px;
            text-align: left;
        }
        
        .scope-item-slide {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: var(--grey-50);
            border-radius: 8px;
        }
        
        .scope-icon-slide {
            width: 48px;
            height: 48px;
            background: var(--yellow-400);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .scope-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .scope-text strong {
            font-size: 14px;
            font-weight: 700;
            color: var(--black);
        }
        
        .scope-text span {
            font-size: 14px;
            color: var(--grey-600);
        }
        
        .btn-slide {
            padding: 18px 48px;
            font-size: 18px;
        }
        
        .mistakes-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 48px;
            text-align: left;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .mistake-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 24px;
            background: var(--grey-50);
            border-radius: 8px;
            border-left: 4px solid var(--red);
        }
        
        .mistake-number {
            width: 36px;
            height: 36px;
            background: var(--red);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .mistake-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .mistake-text strong {
            font-size: 15px;
            font-weight: 700;
            color: var(--black);
        }
        
        .mistake-text span {
            font-size: 14px;
            color: var(--grey-600);
        }
        
        .slide-nav-btns {
            display: flex;
            justify-content: center;
            gap: 16px;
        }
        
        /* Hero */
        .hero {
            background: var(--black);
            color: var(--white);
            padding: 48px;
            border-radius: 4px;
            margin-bottom: 40px;
        }
        
        .hero-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .hero-header .icon { color: var(--yellow-400); }
        
        .hero h1 { font-size: 32px; margin-bottom: 8px; }
        .hero-subtitle { color: var(--grey-400); font-size: 14px; margin-bottom: 20px; }
        .hero p { color: var(--grey-300); font-size: 15px; max-width: 560px; line-height: 1.7; }
        
        /* Scope Grid */
        .scope-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
        }
        
        .scope-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        
        .scope-icon {
            width: 40px;
            height: 40px;
            background: var(--grey-100);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--grey-600);
        }
        
        .scope-item h4 {
            font-size: 11px;
            color: var(--grey-500);
            margin-bottom: 4px;
            font-family: 'Riforma', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 400;
        }
        
        .scope-item p { font-weight: 500; color: var(--grey-800); font-size: 14px; }
        
        /* Warning */
        .warning-card {
            background: var(--white);
            border: 1px solid var(--yellow-300);
            border-left: 3px solid var(--yellow-400);
            border-radius: 4px;
            padding: 24px 32px;
            margin-bottom: 32px;
        }
        
        .warning-card h4 {
            color: var(--grey-800);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
        }
        
        .warning-card h4 .icon { color: var(--yellow-600); }
        
        .warning-card ul { margin-left: 28px; color: var(--grey-600); }
        .warning-card li { margin-bottom: 8px; }
        
        /* Key Learnings */
        .key-learning {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--grey-100);
        }
        
        .key-learning:last-child { border-bottom: none; }
        
        .check-circle {
            width: 20px;
            height: 20px;
            color: var(--green);
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .key-learning span { color: var(--grey-700); }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: 1px solid transparent;
            border-radius: 4px;
            font-family: 'Riforma', sans-serif;
            font-weight: 400;
            cursor: pointer;
            transition: opacity 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .btn:hover:not(:disabled) { opacity: 0.8; }
        
        .btn-primary { 
            background: var(--black); 
            color: var(--white); 
            border-color: var(--black);
        }
        
        .btn-secondary { 
            background: var(--white); 
            color: var(--black); 
            border-color: var(--black);
        }
        
        .btn-yellow { 
            background: var(--yellow-400); 
            color: var(--black);
            border-color: var(--yellow-400);
        }
        
        .btn:disabled { opacity: 0.4; cursor: not-allowed; }
        
        .btn-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 32px;
            border-top: 1px solid var(--grey-200);
            gap: 16px;
        }
        
        /* Forms */
        input, select, textarea {
            font-family: 'Riforma', sans-serif;
            font-size: 14px;
            padding: 12px 16px;
            border: 1px solid var(--grey-300);
            border-radius: 4px;
            width: 100%;
            transition: border-color 0.2s;
            background: var(--white);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--grey-500);
        }
        
        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--grey-700);
            font-size: 13px;
        }
        
        .form-group { margin-bottom: 20px; }
        
        /* Statement Card */
        .statement-card {
            background: var(--white);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            padding: 28px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .statement-card.completed {
            border-color: var(--green);
            background: var(--grey-50);
        }
        
        .statement-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .statement-number {
            width: 40px;
            height: 40px;
            background: var(--yellow-400);
            color: var(--black);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
            flex-shrink: 0;
        }
        
        .statement-dysfunction-badge {
            padding: 4px 10px;
            background: var(--grey-100);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            color: var(--grey-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .statement-text {
            font-size: 15px;
            line-height: 1.7;
            color: var(--grey-800);
            margin-bottom: 16px;
            font-weight: 500;
        }
        
        .statement-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--yellow-50);
            border-radius: 4px;
            font-size: 13px;
            color: var(--grey-600);
            margin-bottom: 20px;
        }
        
        .statement-hint .icon { color: var(--yellow-600); }
        
        .rating-buttons {
            display: flex;
            gap: 12px;
        }
        
        /* ================================================
           TYPEFORM-STYLE ASSESSMENT SLIDES
           ================================================ */
        
        .assessment-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--white);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .assessment-slide {
            min-height: 100vh;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 100px 24px 60px;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .assessment-slide.active {
            display: flex;
        }
        
        .slide-progress-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 20px 24px;
            border-bottom: 1px solid var(--grey-200);
            z-index: 1001;
        }
        
        .slide-progress-inner {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .slide-progress-text {
            font-size: 14px;
            color: var(--grey-500);
            text-align: center;
            margin-bottom: 12px;
        }
        
        .slide-progress-bar {
            height: 6px;
            background: var(--grey-200);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .slide-progress-fill {
            height: 100%;
            background: var(--yellow-400);
            transition: width 0.4s ease;
            border-radius: 3px;
        }
        
        .question-number-badge {
            width: 56px;
            height: 56px;
            background: var(--yellow-400);
            color: var(--black);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 24px;
            font-family: 'Plaak', sans-serif;
            margin-bottom: 32px;
        }
        
        .question-primary {
            font-size: 32px;
            font-weight: 700;
            color: var(--black);
            text-align: center;
            margin-bottom: 16px;
            line-height: 1.3;
            font-family: 'Plaak', sans-serif;
        }
        
        .question-context {
            font-size: 16px;
            color: var(--grey-500);
            text-align: center;
            margin-bottom: 48px;
            max-width: 560px;
            line-height: 1.6;
        }
        
        .answer-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            max-width: 400px;
        }
        
        .answer-btn {
            padding: 22px 32px;
            border: 2px solid var(--grey-300);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
            font-weight: 600;
            font-family: inherit;
            color: var(--grey-700);
        }
        
        .answer-btn:hover {
            border-color: var(--black);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .answer-btn.selected {
            border-color: var(--yellow-400);
            background: var(--yellow-50);
            color: var(--black);
        }
        
        .answer-btn.selected-good {
            border-color: var(--green);
            background: var(--green);
            color: white;
        }
        
        .answer-btn.selected-moderate {
            border-color: var(--amber);
            background: var(--amber);
            color: white;
        }
        
        .answer-btn.selected-bad {
            border-color: var(--red);
            background: var(--red);
            color: white;
        }
        
        .slide-nav {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-top: 48px;
        }
        
        .btn-text-nav {
            background: none;
            border: none;
            color: var(--grey-500);
            font-size: 14px;
            cursor: pointer;
            padding: 12px 16px;
            font-family: inherit;
            transition: color 0.2s;
        }
        
        .btn-text-nav:hover:not(:disabled) {
            color: var(--black);
        }
        
        .btn-text-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Intro slide */
        .intro-slide .form-group {
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
        }
        
        .intro-slide input {
            font-size: 18px;
            padding: 16px 20px;
            text-align: center;
        }
        
        .intro-slide .btn-start {
            margin-top: 32px;
            padding: 18px 48px;
            font-size: 18px;
        }
        
        /* Results slide */
        .results-slide {
            padding-top: 40px;
            padding-bottom: 60px;
        }
        
        .results-hero {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .results-hero .check-icon {
            width: 80px;
            height: 80px;
            background: var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
        }
        
        .results-hero .check-icon svg {
            width: 40px;
            height: 40px;
            color: white;
        }
        
        .results-hero h1 {
            font-size: 36px;
            margin-bottom: 12px;
        }
        
        .results-hero p {
            color: var(--grey-600);
            font-size: 16px;
        }
        
        .ftp-earned-card {
            background: var(--yellow-400);
            border-radius: 8px;
            padding: 20px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            width: 100%;
            max-width: 500px;
        }
        
        .ftp-earned-card span {
            font-size: 14px;
            font-weight: 500;
        }
        
        .ftp-earned-card strong {
            font-size: 32px;
            font-family: 'Plaak', sans-serif;
        }
        
        .priorities-simple {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            max-width: 500px;
            margin-bottom: 32px;
        }
        
        .priority-box {
            background: var(--white);
            border-radius: 8px;
            padding: 24px;
            border-left: 4px solid var(--grey-300);
        }
        
        .priority-box.critical {
            border-left-color: var(--red);
            background: #fef2f2;
        }
        
        .priority-box.moderate {
            border-left-color: var(--amber);
            background: #fffbeb;
        }
        
        .priority-box.healthy {
            border-left-color: var(--green);
            background: #ecfdf5;
        }
        
        .priority-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--grey-500);
            margin-bottom: 8px;
        }
        
        .priority-box h3 {
            font-size: 18px;
            margin-bottom: 6px;
        }
        
        .priority-score {
            font-size: 14px;
            font-weight: 700;
            color: var(--grey-600);
            margin-bottom: 8px;
        }
        
        .priority-insight {
            font-size: 13px;
            color: var(--grey-600);
            margin: 0;
        }
        
        .key-insight-box {
            background: var(--yellow-50);
            border: 1px solid var(--yellow-300);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            width: 100%;
            max-width: 500px;
        }
        
        .key-insight-box h4 {
            font-size: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .key-insight-box p {
            font-size: 14px;
            color: var(--grey-700);
            line-height: 1.7;
            margin: 0;
        }
        
        .next-steps-box {
            background: var(--grey-50);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 32px;
            width: 100%;
            max-width: 500px;
        }
        
        .next-steps-box h4 {
            font-size: 16px;
            margin-bottom: 16px;
        }
        
        .next-steps-box ol {
            margin: 0;
            padding-left: 20px;
            color: var(--grey-700);
            font-size: 14px;
            line-height: 2;
        }
        
        .results-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 500px;
        }
        
        .results-actions .btn {
            width: 100%;
            padding: 18px 24px;
            font-size: 16px;
        }
        
        /* Keyboard hint */
        .keyboard-hint {
            font-size: 12px;
            color: var(--grey-400);
            text-align: center;
            margin-top: 24px;
        }
        
        @media (max-width: 640px) {
            .question-primary {
                font-size: 24px;
            }
            
            .question-context {
                font-size: 14px;
            }
            
            .answer-btn {
                padding: 18px 24px;
                font-size: 16px;
            }
            
            .question-number-badge {
                width: 48px;
                height: 48px;
                font-size: 20px;
            }
        }
        
        /* Dysfunction Score Card (Scores Tab) */
        .dysfunction-score-card {
            background: var(--white);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            padding: 32px;
            margin-bottom: 20px;
        }
        
        .dysfunction-score-card.critical { border-left: 4px solid var(--red); }
        .dysfunction-score-card.moderate { border-left: 4px solid var(--amber); }
        .dysfunction-score-card.healthy { border-left: 4px solid var(--green); }
        
        .dysfunction-score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .priority-badge {
            background: var(--yellow-400);
            color: var(--black);
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-badge-lg {
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: white;
        }
        
        .status-badge-lg.critical { background: var(--red); }
        .status-badge-lg.moderate { background: var(--amber); }
        .status-badge-lg.healthy { background: var(--green); }
        
        .score-display {
            display: flex;
            align-items: baseline;
            gap: 4px;
            margin: 24px 0;
        }
        
        .score-value { font-size: 64px; font-weight: 900; font-family: 'Plaak', sans-serif; line-height: 1; }
        .score-max { font-size: 32px; color: var(--grey-400); font-weight: 600; }
        
        .score-breakdown {
            background: var(--grey-50);
            border-radius: 4px;
            padding: 20px;
            margin-top: 24px;
        }
        
        .score-breakdown h5 {
            font-size: 12px;
            color: var(--grey-600);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Riforma', sans-serif;
            font-weight: 400;
        }
        
        .statement-score-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--grey-200);
            font-size: 13px;
        }
        
        .statement-score-item:last-child { border-bottom: none; }
        .statement-score-item .rating-good { color: var(--green); font-weight: 600; }
        .statement-score-item .rating-moderate { color: var(--amber); font-weight: 600; }
        .statement-score-item .rating-bad { color: var(--red); font-weight: 600; }
        
        .action-preview {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--grey-200);
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--grey-600);
            font-size: 13px;
        }
        
        .action-preview .icon { color: var(--yellow-600); }
        
        /* Complete badge */
        .complete-badge {
            background: var(--green);
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Progress */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: var(--grey-200);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 24px;
        }
        
        .progress-item {
            text-align: center;
            padding: 20px 16px;
            background: var(--white);
        }
        
        .progress-item h4 {
            font-size: 11px;
            color: var(--grey-500);
            margin-bottom: 6px;
            font-family: 'Riforma', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 400;
        }
        
        .progress-item .value { font-size: 22px; font-weight: 700; }
        
        /* Quick View */
        .quick-view {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 16px 20px;
            background: var(--grey-900);
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .quick-view-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--white);
            font-size: 13px;
        }
        
        .traffic-light {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .traffic-light.healthy { background: var(--green); }
        .traffic-light.moderate { background: var(--amber); }
        .traffic-light.critical { background: var(--red); }
        
        /* Brain Juice Box */
        .brain-juice-box {
            background: var(--white);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            padding: 28px;
            margin-bottom: 32px;
        }
        
        .brain-juice-box h4 {
            color: var(--grey-800);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
        }
        
        .brain-juice-box h4 .icon { color: var(--yellow-600); }
        
        .brain-juice-questions {
            display: grid;
            gap: 12px;
        }
        
        .brain-juice-question {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 16px;
            background: var(--grey-50);
            border-radius: 4px;
            font-size: 13px;
        }
        
        .brain-juice-question strong {
            color: var(--grey-800);
            min-width: 90px;
            flex-shrink: 0;
            font-size: 12px;
        }
        
        .brain-juice-question span { color: var(--grey-600); }
        
        /* Priority Cards */
        .priority-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 8px;
        }
        
        .priority-card {
            padding: 24px;
            border-radius: 4px;
            text-align: center;
            color: white;
        }
        
        .priority-card.critical { background: var(--red); }
        .priority-card.moderate { background: var(--amber); }
        .priority-card.healthy { background: var(--green); }
        
        .priority-rank { font-size: 36px; font-weight: 900; opacity: 0.3; line-height: 1; }
        .priority-name { font-family: 'Plaak', sans-serif; font-size: 12px; margin: 8px 0; text-transform: uppercase; letter-spacing: 0.02em; }
        .priority-score { font-size: 22px; font-weight: 700; }
        .priority-status { font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.9; margin-top: 4px; }
        
        /* Action Card */
        .action-card {
            background: var(--white);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            margin-bottom: 24px;
            overflow: hidden;
        }
        
        .action-card-header {
            background: var(--grey-50);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--grey-200);
            gap: 12px;
        }
        
        .action-card-header span:first-child { font-size: 14px; }
        
        .action-card-body { padding: 28px; }
        
        .action-hint {
            background: var(--grey-50);
            border-radius: 4px;
            padding: 16px 20px;
            margin-bottom: 24px;
            font-size: 13px;
            color: var(--grey-600);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .action-hint .icon { color: var(--yellow-600); flex-shrink: 0; margin-top: 1px; }
        
        .action-fields {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }
        
        /* Action Progress Dots */
        .action-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--grey-300);
            transition: all 0.3s ease;
        }
        
        .action-dot.complete {
            background: var(--green);
        }
        
        /* Commitment (removed) */
        /* .commitment-section {
            background: var(--white);
            border: 1px solid var(--yellow-300);
            border-radius: 4px;
            padding: 32px;
            margin: 40px 0;
            animation: fadeSlideIn 0.5s ease-out;
        }
        
        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .commitment-section h3 { 
            margin-bottom: 24px; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .commitment-section h3 .icon { color: var(--yellow-600); }
        
        .commitment-text {
            font-size: 15px;
            line-height: 2.4;
            margin-bottom: 28px;
            color: var(--grey-800);
        }
        
        .commitment-text input {
            border: none;
            border-bottom: 2px solid var(--black);
            background: transparent;
            width: auto;
            min-width: 160px;
            text-align: center;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 0;
        }
        
        .commitment-checkboxes { margin: 24px 0; }
        
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 14px;
            font-size: 14px;
            color: var(--grey-700);
        }
        
        .checkbox-item .icon { color: var(--green); flex-shrink: 0; margin-top: 2px; }
        
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            flex-shrink: 0;
        }
        
        .checkbox-item input[type="date"] {
            width: auto;
            margin-left: 8px;
            padding: 6px 10px;
        }
        
        .forum-peers {
            background: var(--grey-50);
            border-radius: 4px;
            padding: 20px;
            margin-top: 24px;
        }
        
        .forum-peers h5 {
            font-size: 12px;
            color: var(--grey-600);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .forum-peers h5 .icon { color: var(--grey-500); }
        
        .peers-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }
        
        .peer-item {
            font-size: 13px;
            color: var(--grey-600);
            padding: 8px 12px;
            background: var(--white);
            border-radius: 4px;
        }
        
        .guru-note {
            margin-top: 20px;
            padding: 14px 16px;
            background: var(--white);
            border-radius: 4px;
            font-size: 13px;
            color: var(--grey-600);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .guru-note .icon { color: var(--grey-500); }
        
        .signature-field {
            margin-top: 28px;
            padding-top: 28px;
            border-top: 1px solid var(--grey-200);
        }
        
        .signature-field label {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .signature-field label .icon { color: var(--grey-500); }
        
        .signature-field input {
            font-family: 'Georgia', serif;
            font-size: 20px;
            font-style: italic;
            padding: 16px;
            border: 1px dashed var(--grey-400);
            text-align: center;
            margin-top: 8px;
        }
        
        /* Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: var(--grey-200);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--white);
            padding: 24px 20px;
            text-align: center;
        }
        
        .stat-card .icon-wrap {
            width: 40px;
            height: 40px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--grey-600);
        }
        
        .stat-card .icon-wrap.yellow { color: var(--yellow-600); }
        
        .stat-card .value { font-size: 28px; font-weight: 700; font-family: 'Plaak', sans-serif; }
        .stat-card .label { font-size: 12px; color: var(--grey-500); margin-top: 4px; }
        
        /* Mastery */
        .mastery-card {
            background: var(--yellow-400);
            border-radius: 4px;
            padding: 28px;
            margin-bottom: 32px;
            color: var(--black);
        }
        
        .mastery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 16px;
        }
        
        .mastery-level { font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; }
        .mastery-level span { font-family: 'Plaak', sans-serif; font-size: 22px; display: block; margin-top: 4px; }
        .mastery-ftp { text-align: right; }
        .mastery-ftp .value { font-size: 26px; font-weight: 700; }
        .mastery-ftp .label { font-size: 12px; opacity: 0.7; }
        
        .progress-bar {
            height: 6px;
            background: rgba(0,0,0,0.15);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: var(--black);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .mastery-next { margin-top: 12px; font-size: 13px; opacity: 0.7; }
        
        /* Heat Map */
        .heat-map { overflow-x: auto; }
        
        .heat-map table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .heat-map th, .heat-map td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid var(--grey-200);
        }
        
        .heat-map th { 
            font-weight: 600; 
            color: var(--grey-600);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .heat-map th:first-child, .heat-map td:first-child { text-align: left; }
        .heat-map tr:last-child td { border-bottom: none; font-weight: 600; }
        
        .heat-cell {
            display: inline-block;
            min-width: 36px;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 13px;
            color: white;
        }
        
        .heat-cell.healthy { background: var(--green); }
        .heat-cell.moderate { background: var(--amber); }
        .heat-cell.critical { background: var(--red); }
        
        /* Action Tracker */
        .action-tracker-row {
            display: grid;
            grid-template-columns: 100px 1fr 120px 90px 90px;
            gap: 12px;
            padding: 14px 0;
            border-bottom: 1px solid var(--grey-100);
            align-items: center;
            font-size: 13px;
        }
        
        .action-tracker-row:first-child {
            font-weight: 600;
            color: var(--grey-600);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding-bottom: 12px;
        }
        
        .action-tracker-row:last-child { border-bottom: none; }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            background: var(--amber);
            color: white;
        }
        
        /* Reflection */
        .reflection-section {
            background: var(--white);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            padding: 32px;
            margin: 32px 0;
        }
        
        .reflection-section h3 { 
            margin-bottom: 8px; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .reflection-section h3 .icon { color: var(--grey-600); }
        
        .reflection-section > p { color: var(--grey-500); margin-bottom: 24px; font-size: 13px; }
        
        .reflection-question { margin-bottom: 24px; }
        .reflection-question:last-child { margin-bottom: 0; }
        .reflection-question textarea { min-height: 80px; resize: vertical; }
        
        /* Sprint Complete */
        .sprint-complete-card {
            background: var(--green);
            color: white;
            border-radius: 4px;
            padding: 28px;
            margin-bottom: 32px;
        }
        
        .sprint-complete-card h3 { 
            margin-bottom: 8px; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sprint-complete-card p { opacity: 0.9; font-size: 14px; }
        
        .sprint-complete-dates {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }
        
        .sprint-complete-dates div { text-align: center; }
        .sprint-complete-dates label { display: block; font-size: 11px; opacity: 0.7; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.05em; }
        .sprint-complete-dates span { font-weight: 700; font-size: 14px; }
        
        /* Sprint Context */
        .sprint-context {
            background: linear-gradient(135deg, var(--grey-900) 0%, #1a2e1a 100%);
            color: var(--white);
            border-radius: 8px;
            padding: 48px 40px;
            margin-bottom: 32px;
            text-align: center;
            border: 2px solid var(--green);
            position: relative;
            overflow: hidden;
        }
        
        .sprint-context::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--green);
        }
        
        .sprint-context h4 { 
            color: var(--green); 
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .sprint-context h4 .icon { font-size: 32px; }
        
        .sprint-progress-text { 
            color: var(--white); 
            font-size: 18px; 
            opacity: 0.9;
        }
        
        /* Export */
        .export-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 28px;
        }
        
        
        /* Expandable */
        .expandable {
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .expandable-header {
            padding: 16px 20px;
            background: var(--white);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            font-size: 14px;
        }
        
        .expandable-header:hover { background: var(--grey-50); }
        
        .expandable-header .icon { color: var(--grey-500); transition: transform 0.2s; }
        
        .expandable.open .expandable-header .icon { transform: rotate(180deg); }
        
        .expandable-content {
            padding: 20px;
            border-top: 1px solid var(--grey-200);
            display: none;
            background: var(--grey-50);
        }
        
        .expandable.open .expandable-content { display: block; }
        
        /* Chart */
        .chart-bars { margin: 24px 0 0; }
        
        .chart-bar-item {
            display: flex;
            align-items: center;
            margin-bottom: 14px;
            gap: 16px;
        }
        
        .chart-bar-item:last-child { margin-bottom: 0; }
        
        .chart-bar-label {
            width: 80px;
            font-size: 12px;
            font-weight: 500;
            color: var(--grey-600);
            flex-shrink: 0;
        }
        
        .chart-bar-track {
            flex: 1;
            height: 20px;
            background: var(--grey-100);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .chart-bar-fill {
            height: 100%;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: white;
            font-weight: 600;
            font-size: 11px;
            min-width: 28px;
            transition: width 0.3s ease;
        }
        
        .chart-bar-fill.healthy { background: var(--green); }
        .chart-bar-fill.moderate { background: var(--amber); }
        .chart-bar-fill.critical { background: var(--red); }
        
        /* Guru Mode */
        .guru-login-btn {
            background: transparent;
            border: 1px solid var(--grey-600);
            color: var(--grey-400);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        
        .guru-login-btn:hover {
            border-color: var(--yellow-400);
            color: var(--yellow-400);
        }
        
        .guru-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .guru-modal.active {
            display: flex;
        }
        
        .guru-modal-content {
            background: var(--white);
            border-radius: 8px;
            padding: 40px;
            max-width: 480px;
            width: 90%;
            text-align: center;
        }
        
        .guru-modal-content h2 {
            margin-bottom: 12px;
        }
        
        .guru-modal-content p {
            color: var(--grey-600);
            margin-bottom: 24px;
        }
        
        .guru-code-input {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            text-align: center;
            border: 2px solid var(--grey-300);
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .guru-code-input:focus {
            outline: none;
            border-color: var(--yellow-400);
        }
        
        .guru-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--white);
            z-index: 1500;
            display: none;
            overflow-y: auto;
        }
        
        .guru-fullscreen.active {
            display: block;
        }
        
        .guru-header {
            background: var(--grey-900);
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .guru-header h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .guru-header .icon { color: var(--yellow-400); }
        
        .guru-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 32px 24px;
        }
        
        .import-section {
            background: var(--grey-50);
            border: 2px dashed var(--grey-300);
            border-radius: 8px;
            padding: 32px;
            margin-bottom: 32px;
        }
        
        .import-section h3 {
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .import-textarea {
            width: 100%;
            min-height: 100px;
            padding: 16px;
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            margin-bottom: 16px;
            resize: vertical;
        }
        
        .imported-list {
            margin-top: 24px;
        }
        
        .imported-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--white);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            margin-bottom: 8px;
        }
        
        .imported-item.success {
            border-left: 4px solid var(--green);
        }
        
        .imported-item .name {
            font-weight: 600;
        }
        
        .imported-item .role {
            color: var(--grey-500);
            font-size: 13px;
        }
        
        .team-summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 32px;
        }
        
        .team-summary-table th {
            background: var(--grey-900);
            color: white;
            padding: 12px 16px;
            text-align: center;
            font-weight: 600;
            font-size: 13px;
        }
        
        .team-summary-table th:first-child {
            text-align: left;
        }
        
        .team-summary-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--grey-200);
            text-align: center;
        }
        
        .team-summary-table td:first-child {
            text-align: left;
            font-weight: 600;
        }
        
        .team-summary-table tr.average-row {
            background: var(--yellow-50);
            font-weight: 700;
        }
        
        .team-summary-table tr.average-row td {
            border-top: 2px solid var(--grey-900);
        }
        
        .score-cell {
            font-weight: 600;
            font-size: 16px;
        }
        
        .score-cell.healthy { color: var(--green); }
        .score-cell.moderate { color: var(--amber); }
        .score-cell.critical { color: var(--red); }
        
        .variance-alert {
            background: var(--yellow-50);
            border: 1px solid var(--yellow-300);
            border-left: 4px solid var(--amber);
            padding: 16px 20px;
            border-radius: 4px;
            margin-bottom: 16px;
        }
        
        .variance-alert h4 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            color: var(--amber);
        }
        
        .variance-alert p {
            color: var(--grey-700);
            font-size: 14px;
            margin: 0;
        }
        
        .priorities-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .priority-summary-card {
            padding: 24px;
            border-radius: 8px;
            text-align: center;
        }
        
        .priority-summary-card.critical {
            background: var(--red);
            color: white;
        }
        
        .priority-summary-card.moderate {
            background: var(--amber);
            color: white;
        }
        
        .priority-summary-card h4 {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .priority-summary-card h3 {
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .priority-summary-card .score {
            font-size: 32px;
            font-weight: 900;
        }
        
        .submission-code-card {
            background: var(--grey-900);
            color: white;
            padding: 24px;
            border-radius: 8px;
            margin: 24px 0;
        }
        
        .submission-code-card h4 {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .submission-code-card .code-display {
            background: var(--grey-800);
            padding: 16px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin-bottom: 16px;
            max-height: 80px;
            overflow-y: auto;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content { flex-wrap: wrap; }
            .sprint-badge { display: none; }
            .hero { padding: 32px 24px; }
            .hero h1 { font-size: 20px; }
            .tabs-nav { overflow-x: auto; }
            .tab-btn { padding: 12px 16px; font-size: 13px; white-space: nowrap; }
            .progress-summary { grid-template-columns: repeat(2, 1fr); }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .priority-cards { grid-template-columns: 1fr; }
            .action-fields { grid-template-columns: 1fr; }
            .slide-title { font-size: 28px; }
            .slide-description { font-size: 16px; }
            .scope-grid-slide { grid-template-columns: 1fr; }
            .slide-nav-btns { flex-direction: column; }
            .btn-slide { width: 100%; }
            .action-tracker-row { grid-template-columns: 1fr; gap: 8px; }
            .sliders-grid { grid-template-columns: 1fr 1fr; }
            .sprint-complete-dates { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <span class="sprint-badge"><strong>Sprint 5</strong> of 32 | Team Dynamics</span>
                <div class="ftp-display">
                    <span class="icon icon-sm"><i data-lucide="zap"></i></span>
                    <span id="ftp-count">0 FTP</span>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 16px;">
                <button class="guru-login-btn" onclick="openGuruModal()">
                    <span class="icon icon-sm"><i data-lucide="key"></i></span>
                    Guru Login
                </button>
                <div class="logo">
                    <img src="fast track tool logo.png" alt="Fast Track">
                </div>
            </div>
        </div>
    </header>
    
    <!-- Guru Login Modal -->
    <div class="guru-modal" id="guru-modal">
        <div class="guru-modal-content">
            <h2> Guru Mode</h2>
            <p>Enter your sprint code to access the Team Summary dashboard</p>
            <input type="text" class="guru-code-input" id="guru-code-input" placeholder="SPRINT CODE" maxlength="20">
            <div id="guru-code-error" style="color: var(--red); font-size: 13px; margin-bottom: 16px; display: none;">
                Invalid code. Please try again.
            </div>
            <div style="display: flex; gap: 12px; justify-content: center;">
                <button class="btn btn-secondary" onclick="closeGuruModal()">Cancel</button>
                <button class="btn btn-primary" onclick="validateGuruCode()">
                    <span class="icon icon-sm"><i data-lucide="unlock"></i></span>
                    Unlock
                </button>
            </div>
            <p style="margin-top: 20px; font-size: 12px; color: var(--grey-500);">
                Get your sprint code from Fast Track
            </p>
        </div>
    </div>
    
    <!-- Guru Mode Fullscreen -->
    <div class="guru-fullscreen" id="guru-fullscreen">
        <div class="guru-header">
            <h2>
                <span class="icon icon-md"><i data-lucide="users"></i></span>
                Guru Mode - Team Summary
            </h2>
            <button class="btn btn-secondary" onclick="closeGuruMode()" style="background: transparent; border-color: var(--grey-600); color: white;">
                <span class="icon icon-sm"><i data-lucide="x"></i></span>
                Exit Guru Mode
            </button>
        </div>
        <div class="guru-container">
            <!-- Import Section -->
            <div class="import-section" id="import-section">
                <!-- Database Load Option -->
                <div style="background: var(--yellow-50); border: 1px solid var(--yellow-300); border-radius: 8px; padding: 20px; margin-bottom: 24px;">
                    <h3 style="margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                        <span class="icon icon-md" style="color: var(--yellow-600);"><i data-lucide="database"></i></span>
                        Load from Database
                        <span style="font-size: 11px; background: var(--green); color: white; padding: 2px 8px; border-radius: 10px;">Recommended</span>
                    </h3>
                    <p style="color: var(--grey-600); margin-bottom: 16px; font-size: 13px;">
                        Select a company to automatically load all submitted assessments.
                    </p>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <select id="company-select" style="flex: 1; padding: 12px 16px; border: 1px solid var(--grey-300); border-radius: 4px; font-size: 14px; background: white;">
                            <option value="">Select a company...</option>
                        </select>
                        <button class="btn btn-yellow" onclick="loadCompanyAssessments()">
                            <span class="icon icon-sm"><i data-lucide="download-cloud"></i></span>
                            Load Team
                        </button>
                    </div>
                    <div id="db-load-status" style="margin-top: 12px; font-size: 12px; display: none;"></div>
                </div>
                
                <!-- Divider -->
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                    <div style="flex: 1; height: 1px; background: var(--grey-300);"></div>
                    <span style="font-size: 12px; color: var(--grey-500);">or import manually</span>
                    <div style="flex: 1; height: 1px; background: var(--grey-300);"></div>
                </div>
                
                <!-- Manual Code Import -->
                <h3 style="margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                    <span class="icon icon-md"><i data-lucide="clipboard-paste"></i></span>
                    Import via Code
                </h3>
                <p style="color: var(--grey-600); margin-bottom: 20px; font-size: 13px;">
                    Paste submission codes from team members below. Each code contains their complete assessment data.
                </p>
                <textarea class="import-textarea" id="import-code-input" placeholder="Paste a team member's submission code here..."></textarea>
                <button class="btn btn-primary" onclick="importAssessment()">
                    <span class="icon icon-sm"><i data-lucide="plus"></i></span>
                    Import Assessment
                </button>
                
                <div class="imported-list" id="imported-list">
                    <h4 style="margin-bottom: 16px; color: var(--grey-600);">
                        Imported Team Members (<span id="imported-count">0</span>/8)
                    </h4>
                    <div id="imported-members"></div>
                </div>
            </div>
            
            <!-- Team Summary (hidden until 2+ members imported) -->
            <div id="team-summary-section" style="display: none;">
                <h2 style="margin-bottom: 24px;">
                    <span class="icon icon-md"><i data-lucide="bar-chart-2"></i></span>
                    Team Dysfunction Summary
                </h2>
                
                <!-- Top 3 Priorities -->
                <div class="priorities-summary" id="team-priorities"></div>
                
                <!-- Variance Alerts -->
                <div id="variance-alerts"></div>
                
                <!-- Full Table -->
                <div class="card" style="padding: 0; overflow: hidden;">
                    <table class="team-summary-table" id="team-summary-table">
                        <!-- Generated by JavaScript -->
                    </table>
                </div>
                
                <!-- Export Options -->
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button class="btn btn-primary" onclick="window.print()">
                        <span class="icon icon-sm"><i data-lucide="file-text"></i></span>
                        Export PDF
                    </button>
                    <button class="btn btn-secondary" onclick="copyTeamSummary()">
                        <span class="icon icon-sm"><i data-lucide="copy"></i></span>
                        Copy Summary
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Tabs Navigation -->
        <nav class="tabs-nav">
            <button class="tab-btn active" onclick="showTab('reference')" id="tab-reference">
                <span class="icon icon-sm"><i data-lucide="book-open"></i></span>
                Reference
            </button>
            <button class="tab-btn" onclick="showTab('assessment')" id="tab-assessment">
                <span class="icon icon-sm"><i data-lucide="clipboard-list"></i></span>
                Assessment
            </button>
            <button class="tab-btn" onclick="showTab('scores')" id="tab-scores" disabled>
                <span class="icon icon-sm"><i data-lucide="lock"></i></span>
                Your Scores
            </button>
            <button class="tab-btn" onclick="showTab('action')" id="tab-action" disabled>
                <span class="icon icon-sm"><i data-lucide="lock"></i></span>
                Action Plan
            </button>
            <button class="tab-btn" onclick="showTab('dashboard')" id="tab-dashboard" disabled>
                <span class="icon icon-sm"><i data-lucide="lock"></i></span>
                Dashboard
            </button>
        </nav>

        <!-- TAB 1: REFERENCE -->
        <div id="reference" class="tab-content active">
            <!-- SLIDE 1: Brain Juice Applied + Assessment Scope -->
            <div id="ref-slide-1" class="ref-slide active">
                <div class="slide-container">
                    <div class="slide-badge">
                        <span class="icon icon-lg"><i data-lucide="lightbulb"></i></span>
                    </div>
                    
                    <h1 class="slide-title">Brain Juice Applied</h1>
                    <p class="slide-subtitle">Sprint 5 of 32 | Module: Individual & Company Identity</p>
                    
                    <div class="scope-grid-slide">
                        <div class="scope-item-slide">
                            <div class="scope-icon-slide"><i data-lucide="users"></i></div>
                            <div class="scope-text">
                                <strong>Scope</strong>
                                <span>Your C-level team (5-8 direct reports)</span>
                            </div>
                        </div>
                        <div class="scope-item-slide">
                            <div class="scope-icon-slide"><i data-lucide="calendar"></i></div>
                            <div class="scope-text">
                                <strong>Time Frame</strong>
                                <span>Last 90 days observed</span>
                            </div>
                        </div>
                        <div class="scope-item-slide">
                            <div class="scope-icon-slide"><i data-lucide="eye"></i></div>
                            <div class="scope-text">
                                <strong>Perspective</strong>
                                <span>Your honest assessment</span>
                            </div>
                        </div>
                        <div class="scope-item-slide">
                            <div class="scope-icon-slide"><i data-lucide="x-circle"></i></div>
                            <div class="scope-text">
                                <strong>Exclude</strong>
                                <span>Yourself, board, indirect reports</span>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary btn-slide" onclick="nextRefSlide()">
                        Continue
                        <span class="icon icon-sm"><i data-lucide="arrow-right"></i></span>
                    </button>
                </div>
            </div>
            
            <!-- SLIDE 2: Common Mistakes to Avoid -->
            <div id="ref-slide-2" class="ref-slide">
                <div class="slide-container">
                    <div class="slide-badge warning">
                        <span class="icon icon-lg"><i data-lucide="alert-triangle"></i></span>
                    </div>
                    
                    <h1 class="slide-title">Common Mistakes to Avoid</h1>
                    <p class="slide-subtitle">Before you start, keep these in mind</p>
                    
                    <div class="mistakes-list">
                        <div class="mistake-item">
                            <div class="mistake-number">1</div>
                            <div class="mistake-text">
                                <strong>Don't rate how you WANT team to be</strong>
                                <span>Rate CURRENT reality only</span>
                            </div>
                        </div>
                        <div class="mistake-item">
                            <div class="mistake-number">2</div>
                            <div class="mistake-text">
                                <strong>Rate based on OBSERVED BEHAVIORS only</strong>
                                <span>Not assumptions or intentions</span>
                            </div>
                        </div>
                        <div class="mistake-item">
                            <div class="mistake-number">3</div>
                            <div class="mistake-text">
                                <strong>Don't confuse absence of dysfunction with health</strong>
                                <span>Look for active positive behaviors</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="slide-nav-btns">
                        <button class="btn btn-secondary" onclick="prevRefSlide()">
                            <span class="icon icon-sm"><i data-lucide="arrow-left"></i></span>
                            Back
                        </button>
                        <button class="btn btn-primary btn-slide" onclick="showTab('assessment')">
                            Begin Your Assessment
                            <span class="icon icon-sm"><i data-lucide="arrow-right"></i></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: ASSESSMENT -->
        <div id="assessment" class="tab-content">
            <!-- Assessment Entry Point -->
            <div id="assessment-intro" class="card" style="text-align: center; padding: 60px 40px;">
                <div class="question-number-badge" style="margin: 0 auto 24px;">
                    <span class="icon icon-md"><i data-lucide="clipboard-check"></i></span>
                </div>
                <h2 style="margin-bottom: 12px;">Team Dysfunction Assessment</h2>
                <p style="color: var(--grey-600); margin-bottom: 32px; max-width: 480px; margin-left: auto; margin-right: auto;">
                    15 questions about your team's dynamics. Takes 3-5 minutes.<br>
                    <strong>Answer honestly based on the last 90 days.</strong>
                </p>
                
                <div style="max-width: 400px; margin: 0 auto 32px;">
                    <!-- Email Login (Database Mode) -->
                    <div id="email-login-section" style="margin-bottom: 24px; padding: 20px; background: var(--yellow-50); border: 1px solid var(--yellow-300); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                            <span class="icon icon-sm" style="color: var(--yellow-600);"><i data-lucide="database"></i></span>
                            <label style="text-align: left; font-weight: 600; color: var(--grey-800); margin: 0;">Login with Email</label>
                            <span style="font-size: 11px; background: var(--green); color: white; padding: 2px 8px; border-radius: 10px;">Saves to Database</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <input type="email" id="user-email" placeholder="your.email@company.com" style="flex: 1; font-size: 14px; padding: 12px 14px;">
                            <button class="btn btn-yellow" onclick="loginWithEmail()" style="padding: 12px 16px; white-space: nowrap;">
                                <span class="icon icon-sm"><i data-lucide="log-in"></i></span>
                                Login
                            </button>
                        </div>
                        <div id="login-status" style="margin-top: 10px; font-size: 12px; display: none;"></div>
                        <p style="margin-top: 10px; font-size: 11px; color: var(--grey-500);">
                            Your assessment will be saved automatically. Your Guru will see results instantly.
                        </p>
                    </div>
                    
                    <!-- Logged In Status -->
                    <div id="logged-in-status" style="display: none; margin-bottom: 24px; padding: 16px; background: var(--green); color: white; border-radius: 8px;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="icon icon-md"><i data-lucide="check-circle"></i></span>
                                <div>
                                    <strong id="logged-in-name">Sarah Chen</strong>
                                    <span id="logged-in-role" style="opacity: 0.9;"></span>
                                    <div style="font-size: 12px; opacity: 0.9;" id="logged-in-company"></div>
                                </div>
                            </div>
                            <button onclick="logoutUser()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                Change User
                            </button>
                        </div>
                    </div>
                    
                    <!-- Divider -->
                    <div id="or-divider" style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                        <div style="flex: 1; height: 1px; background: var(--grey-300);"></div>
                        <span style="font-size: 12px; color: var(--grey-500);">or continue without login</span>
                        <div style="flex: 1; height: 1px; background: var(--grey-300);"></div>
                    </div>
                    
                    <!-- Manual Entry (Offline Mode) -->
                    <div id="manual-entry-section">
                        <div class="form-group" style="margin-bottom: 16px;">
                            <label style="text-align: left;">Your Name</label>
                            <input type="text" id="assessor-name" placeholder="e.g., Sarah Chen" style="font-size: 16px; padding: 14px 16px;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="text-align: left;">Your Role (Optional)</label>
                            <input type="text" id="assessor-role" placeholder="e.g., CFO" style="font-size: 16px; padding: 14px 16px;">
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary btn-start" onclick="startAssessment()" id="start-assessment-btn" disabled style="padding: 18px 48px; font-size: 18px;">
                    Start Assessment 
                </button>
                
                <p style="margin-top: 24px; font-size: 13px; color: var(--grey-500);">
                    or <a href="#" onclick="loadExampleAssessment(); return false;" style="color: var(--yellow-600);">load example assessment</a>
                </p>
            </div>
            
            <!-- Back to Reference -->
            <div class="btn-nav" style="margin-top: 24px;">
                <button class="btn btn-secondary" onclick="showTab('reference')">
                    <span class="icon icon-sm"><i data-lucide="arrow-left"></i></span>
                    Back to Reference
                </button>
            </div>
        </div>
        
        <!-- FULL-SCREEN ASSESSMENT SLIDES (outside tab container) -->
        <div id="assessment-fullscreen" class="assessment-fullscreen" style="display: none;">
            <!-- Progress Header -->
            <div class="slide-progress-header">
                <div class="slide-progress-inner">
                    <div class="slide-progress-text" id="slide-progress-text">Question 1 of 15</div>
                    <div class="slide-progress-bar">
                        <div class="slide-progress-fill" id="slide-progress-fill" style="width: 6.67%"></div>
                    </div>
                </div>
            </div>
            
            <!-- Exit button -->
            <button onclick="exitAssessment()" style="position: fixed; top: 20px; right: 24px; z-index: 1002; background: none; border: none; cursor: pointer; color: var(--grey-400); padding: 8px;">
                <span class="icon icon-md"><i data-lucide="x"></i></span>
            </button>
            
            <!-- Slides container - generated by JavaScript -->
            <div id="slides-container"></div>
            
            <!-- Results Slide -->
            <div id="results-slide" class="assessment-slide results-slide" style="display: none;">
                <div class="results-hero">
                    <div class="check-icon">
                        <span class="icon icon-lg"><i data-lucide="check"></i></span>
                    </div>
                    <h1>Assessment Complete</h1>
                    <p>Your team's top dysfunction areas identified</p>
                </div>
                
                <div class="ftp-earned-card">
                    <span>Assessment Complete</span>
                    <strong>+25 FTP</strong>
                </div>
                
                <div class="priorities-simple" id="results-priorities"></div>
                
                <div class="key-insight-box" id="results-insight">
                    <h4> Key Insight</h4>
                    <p id="results-insight-text"></p>
                </div>
                
                <div class="next-steps-box">
                    <h4>What Happens Next</h4>
                    <ol>
                        <li>Guru compiles all team assessments</li>
                        <li>Team reviews during Fast Track hour</li>
                        <li>Team creates action plan together</li>
                    </ol>
                </div>
                
                <div class="results-actions">
                    <button class="btn btn-primary" onclick="exitAndGoToAction()">
                        Continue to Action Planning 
                    </button>
                    <button class="btn btn-secondary" onclick="copyAssessmentLink()">
                        <span class="icon icon-sm"><i data-lucide="link"></i></span>
                        Copy Link to Share
                    </button>
                </div>
            </div>
        </div>

        <!-- TAB 3: YOUR SCORES (NEW) -->
        <div id="scores" class="tab-content">
            <!-- Success Hero -->
            <div class="hero" style="background: var(--green);">
                <div class="hero-header">
                    <span class="icon icon-lg"><i data-lucide="check-circle"></i></span>
                    <h1 style="color: white;">Assessment Complete!</h1>
                </div>
                <p style="color: rgba(255,255,255,0.9);">You've honestly assessed your team's dynamics. Your Guru will compile everyone's responses for the team discussion.</p>
            </div>

            <!-- FTP Earned Card -->
            <div class="card" style="background: var(--yellow-400); border-color: var(--yellow-400);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="margin-bottom: 8px;">
                            <span class="icon icon-md"><i data-lucide="zap"></i></span>
                            FTP Earned
                        </h3>
                        <p style="margin: 0; font-size: 14px; opacity: 0.8;">Fast Track Points for completing your assessment</p>
                    </div>
                    <div style="font-size: 48px; font-weight: 900; font-family: 'Plaak', sans-serif;">+25</div>
                </div>
            </div>

            <!-- Dysfunction Scores Summary -->
            <div class="card">
                <h3 style="margin-bottom: 20px;">
                    <span class="icon icon-md"><i data-lucide="bar-chart-2"></i></span>
                    Your Team's Dysfunction Scores
                </h3>
                <div id="dysfunction-scores-summary"></div>
            </div>

            <!-- What Happens Next -->
            <div class="card">
                <h3>
                    <span class="icon icon-md"><i data-lucide="arrow-right-circle"></i></span>
                    What Happens Next
                </h3>
                <ol style="margin-left: 20px; color: var(--grey-700); line-height: 2;">
                    <li><strong>Guru Compiles Results:</strong> Your Guru will combine all team members' assessments</li>
                    <li><strong>Team Discussion:</strong> You'll review compiled results together during Fast Track hour</li>
                    <li><strong>Action Planning:</strong> Team collaboratively creates improvement plan (next tab)</li>
                    <li><strong>CEO Commitment:</strong> CEO commits to implementing actions at Forum</li>
                </ol>
            </div>

            <!-- Submission Code for Guru -->
            <div class="submission-code-card">
                <h4>
                    <span class="icon icon-md"><i data-lucide="key"></i></span>
                    Your Submission Code
                </h4>
                <p style="color: var(--grey-400); margin-bottom: 16px; font-size: 14px;">
                    Send this code to your Guru so they can compile the team summary.
                </p>
                <div class="code-display" id="submission-code">
                    <!-- Generated when scores tab is shown -->
                </div>
                <button class="btn btn-yellow" onclick="copySubmissionCode()" style="width: 100%;">
                    <span class="icon icon-sm"><i data-lucide="copy"></i></span>
                    Copy Code to Clipboard
                </button>
            </div>
            
            <!-- Export Your Assessment -->
            <div class="card">
                <h3>
                    <span class="icon icon-md"><i data-lucide="share-2"></i></span>
                    Other Export Options
                </h3>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary" onclick="window.print()">
                        <span class="icon icon-sm"><i data-lucide="file-text"></i></span>
                        Export PDF
                    </button>
                </div>
            </div>

            <div class="btn-nav">
                <button class="btn btn-secondary" onclick="showTab('assessment')">
                    <span class="icon icon-sm"><i data-lucide="arrow-left"></i></span>
                    Back to Assessment
                </button>
                <button class="btn btn-primary" onclick="showTab('action')">
                    Continue to Action Planning
                    <span class="icon icon-sm"><i data-lucide="arrow-right"></i></span>
                </button>
            </div>
        </div>

        <!-- TAB 4: ACTION PLAN -->
        <div id="action" class="tab-content">
            <!-- Instructions -->
            <div class="card" style="background: var(--grey-50);">
                <p style="margin: 0; color: var(--grey-700); line-height: 1.7;">
                    With the scores at hand, initiate an open and honest discussion within the team (during the Fast Track hour). 
                    Talk about the areas of strength, acknowledge the challenges, and collectively brainstorm on actionable steps to overcome the dysfunctions. 
                    In the end, choose the most important <strong>3 action points</strong> you want to implement first.
                </p>
            </div>

            <!-- ALL 5 Dysfunctions Table -->
            <div class="card">
                <h3 style="margin-bottom: 20px;">
                    <span class="icon icon-md"><i data-lucide="bar-chart-2"></i></span>
                    Your Personal Dysfunction Scores
                </h3>
                <div id="dysfunction-action-table"></div>
            </div>

            <!-- 3 Action Items (What/Who/When) -->
            <div class="card">
                <h3 style="margin-bottom: 20px;">
                    <span class="icon icon-md"><i data-lucide="target"></i></span>
                    3 Priority Actions
                </h3>
                <p style="color: var(--grey-600); margin-bottom: 24px; font-size: 13px;">Choose 3 actions to implement. Assign a responsible person and deadline.</p>
                <div id="www-actions-container"></div>
            </div>


            <div class="btn-nav">
                <button class="btn btn-secondary" onclick="showTab('assessment')">
                    <span class="icon icon-sm"><i data-lucide="arrow-left"></i></span>
                    Back to Assessment
                </button>
                <button class="btn btn-primary" onclick="showTab('dashboard')" id="view-dashboard-btn" disabled>
                    View Dashboard
                    <span class="icon icon-sm"><i data-lucide="arrow-right"></i></span>
                </button>
            </div>
        </div>

        <!-- TAB 4: DASHBOARD -->
        <div id="dashboard" class="tab-content">
            <div class="export-buttons">
                <button class="btn btn-primary" onclick="window.print()">
                    <span class="icon icon-sm"><i data-lucide="file-text"></i></span>
                    Export PDF
                </button>
                <button class="btn btn-secondary" onclick="copyLink()">
                    <span class="icon icon-sm"><i data-lucide="link"></i></span>
                    Copy Link
                </button>
            </div>

            <div class="mastery-card">
                <div class="mastery-header">
                    <div class="mastery-level">
                        Current Level
                        <span id="mastery-level">NOVICE</span>
                    </div>
                    <div class="mastery-ftp">
                        <div class="value" id="mastery-ftp">0</div>
                        <div class="label">FTP</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="mastery-progress" style="width: 0%"></div>
                </div>
                <div class="mastery-next" id="mastery-next">200 more FTP needed for PRACTITIONER level</div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="icon-wrap"><i data-lucide="bar-chart-2"></i></div>
                    <div class="value" id="overall-score">0.0</div>
                    <div class="label">Team Health Score</div>
                </div>
                <div class="stat-card">
                    <div class="icon-wrap" id="critical-icon-wrap"><i data-lucide="alert-triangle"></i></div>
                    <div class="value" id="critical-count">0</div>
                    <div class="label">Critical Areas</div>
                </div>
                <div class="stat-card">
                    <div class="icon-wrap"><i data-lucide="clipboard-check"></i></div>
                    <div class="value" id="actions-count">0</div>
                    <div class="label">Actions Committed</div>
                </div>
                <div class="stat-card">
                    <div class="icon-wrap yellow"><i data-lucide="zap"></i></div>
                    <div class="value" style="color: var(--yellow-600);" id="ftp-earned">+0</div>
                    <div class="label">FTP Earned</div>
                </div>
            </div>

            <div class="sprint-context">
                <h4>
                    <span class="icon icon-lg"><i data-lucide="trophy"></i></span>
                    Sprint 5 of 32 Complete!
                </h4>
                <div class="sprint-progress-text"> You're 15.6% through the Fast Track Program</div>
            </div>

            <div class="card">
                <h3>
                    <span class="icon icon-md"><i data-lucide="grid-3x3"></i></span>
                    Team Health Heat Map
                </h3>
                <div class="heat-map">
                    <table id="heat-map-table">
                        <thead>
                            <tr>
                                <th>Team Member</th>
                                <th>Role</th>
                                <th>Trust</th>
                                <th>Conflict</th>
                                <th>Commit</th>
                                <th>Account</th>
                                <th>Results</th>
                            </tr>
                        </thead>
                        <tbody id="heat-map-body"></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>
                    <span class="icon icon-md"><i data-lucide="bar-chart-2"></i></span>
                    Dysfunction Scores
                </h3>
                <div class="chart-bars" id="chart-bars"></div>
            </div>

            <div class="card">
                <h3>
                    <span class="icon icon-md"><i data-lucide="clipboard-list"></i></span>
                    Action Tracker
                </h3>
                <div id="action-tracker">
                    <div class="action-tracker-row">
                        <div>Dysfunction</div>
                        <div>Action</div>
                        <div>Owner</div>
                        <div>Start</div>
                        <div>Status</div>
                    </div>
                </div>
            </div>

            <div class="reflection-section">
                <h3>
                    <span class="icon icon-md"><i data-lucide="edit-3"></i></span>
                    Reflection Time
                </h3>
                <p>Before presenting at Forum, reflect on these questions from your Brain Juice:</p>
                
                <div class="reflection-question">
                    <label>How will you actively contribute to building trust within your team?</label>
                    <textarea id="reflection-trust" placeholder="Reflect on your role in building trust..."></textarea>
                </div>
                <div class="reflection-question">
                    <label>What steps will you take to ensure that conflict is managed constructively?</label>
                    <textarea id="reflection-conflict" placeholder="Reflect on how you'll handle conflict..."></textarea>
                </div>
                <div class="reflection-question">
                    <label>How can you reinforce accountability and ensure team goals are prioritized?</label>
                    <textarea id="reflection-accountability" placeholder="Reflect on accountability systems..."></textarea>
                </div>
            </div>

            <div class="sprint-complete-card">
                <h3>
                    <span class="icon icon-md"><i data-lucide="sparkles"></i></span>
                    Sprint Complete!
                </h3>
                <p>You've committed to meaningful action. Strong momentum!</p>
                <div class="sprint-complete-dates">
                    <div><label>Forum Date</label><span id="final-forum-date">Not set</span></div>
                    <div><label>Team Share</label><span id="final-team-date">Not set</span></div>
                    <div><label>Guru Review</label><span id="final-guru-date">Scheduled</span></div>
                </div>
            </div>

            <div class="btn-nav">
                <button class="btn btn-secondary" onclick="showTab('action')">
                    <span class="icon icon-sm"><i data-lucide="arrow-left"></i></span>
                    Back to Action Plan
                </button>
                <button class="btn btn-yellow" onclick="if(confirm('Start new assessment? This will reset all data.')) location.reload();">
                    <span class="icon icon-sm"><i data-lucide="refresh-cw"></i></span>
                    Start New Assessment
                </button>
            </div>
        </div>
    </div>


    <script>
        // ================================================
        // SUPABASE CONNECTION
        // ================================================
        const SUPABASE_URL = 'https://yhcwjlqjbwhijxzdgvoz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InloY3dqbHFqYndoaWp4emRndm96Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTg5NjMsImV4cCI6MjA4MDIzNDk2M30.ACAd3W7sCnJvkmsfmzW10_Z-sKxLh03zEArfOwavKZI';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Current user/company state (populated after login)
        let currentUser = null;
        let currentCompany = null;
        let isOnlineMode = false; // Toggle between offline (code-based) and online (database) mode

        // ================================================
        // DATABASE FUNCTIONS
        // ================================================
        
        // Look up user by email
        async function lookupUserByEmail(email) {
            const { data, error } = await supabase
                .from('users')
                .select('*, companies(*)')
                .eq('email', email.toLowerCase().trim())
                .single();
            
            if (error) {
                console.log('User lookup error:', error);
                return null;
            }
            return data;
        }
        
        // Save assessment to database
        async function saveAssessmentToDatabase() {
            if (!currentUser || !currentCompany) {
                console.log('No user logged in, cannot save to database');
                return { success: false, error: 'Not logged in' };
            }
            
            const scores = calculateScores();
            
            // Check if submission already exists for this user/sprint
            const { data: existing } = await supabase
                .from('submissions')
                .select('id')
                .eq('user_id', currentUser.id)
                .eq('sprint_id', 5)
                .single();
            
            let result;
            if (existing) {
                // Update existing submission
                result = await supabase
                    .from('submissions')
                    .update({
                        responses: assessment.responses,
                        scores: scores,
                        ftp_earned: calculateFTP(),
                        submitted_at: new Date().toISOString()
                    })
                    .eq('id', existing.id);
            } else {
                // Insert new submission
                result = await supabase
                    .from('submissions')
                    .insert({
                        user_id: currentUser.id,
                        company_id: currentCompany.id,
                        sprint_id: 5,
                        responses: assessment.responses,
                        scores: scores,
                        ftp_earned: calculateFTP()
                    });
            }
            
            if (result.error) {
                console.error('Save error:', result.error);
                return { success: false, error: result.error.message };
            }
            
            return { success: true };
        }
        
        // Load team assessments for Guru Mode
        async function loadTeamAssessmentsFromDatabase(companyId) {
            const { data, error } = await supabase
                .from('submissions')
                .select('*, users(name, role)')
                .eq('company_id', companyId)
                .eq('sprint_id', 5);
            
            if (error) {
                console.error('Load team error:', error);
                return [];
            }
            
            // Transform to match existing format
            return data.map(sub => ({
                name: sub.users?.name || 'Unknown',
                role: sub.users?.role || '',
                timestamp: sub.submitted_at,
                scores: sub.scores,
                responses: sub.responses
            }));
        }
        
        // Save actions to database
        async function saveActionsToDatabase() {
            if (!currentCompany) return;
            
            for (let i = 0; i < 3; i++) {
                const action = actions[i];
                if (action.what || action.who || action.when) {
                    await supabase
                        .from('actions')
                        .upsert({
                            company_id: currentCompany.id,
                            sprint_id: 5,
                            action_number: i + 1,
                            what: action.what,
                            who: action.who,
                            when: action.when
                        }, {
                            onConflict: 'company_id,sprint_id,action_number'
                        });
                }
            }
        }
        
        // Save dysfunction notes to database
        async function saveDysfunctionNotesToDatabase() {
            if (!currentCompany) return;
            
            for (const [dysfunction, note] of Object.entries(dysfunctionNotes)) {
                if (note) {
                    await supabase
                        .from('dysfunction_notes')
                        .upsert({
                            company_id: currentCompany.id,
                            sprint_id: 5,
                            dysfunction: dysfunction,
                            note: note
                        }, {
                            onConflict: 'company_id,sprint_id,dysfunction'
                        });
                }
            }
        }
        
        // Get all companies (for Guru dropdown)
        async function getAllCompanies() {
            const { data, error } = await supabase
                .from('companies')
                .select('*')
                .order('name');
            
            return error ? [] : data;
        }

        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            init();
        });

        // Data - The 15 Behavioral Statements (Lencioni's Framework)
        const STATEMENTS = [
            { id: 1, text: "Team members are passionate and unguarded in the discussion of issues.", dysfunction: "conflict", hint: "Do people speak freely or hold back?" },
            { id: 2, text: "Team members call out one another's deficiencies or unproductive behaviors.", dysfunction: "accountability", hint: "Do peers address issues directly?" },
            { id: 3, text: "Team members know what their peers are working on and how they contribute to the collective good of the team.", dysfunction: "commitment", hint: "Is everyone aligned on team goals?" },
            { id: 4, text: "Team members quickly and genuinely apologize to one another when they say or do something inappropriate or possibly damaging to the team.", dysfunction: "trust", hint: "Do people admit mistakes easily?" },
            { id: 5, text: "Team members willingly make sacrifices (such as budget, turf, head count) in their departments or areas of expertise for the good of the team.", dysfunction: "results", hint: "Does 'we' win over 'me'?" },
            { id: 6, text: "Team members openly admit their weaknesses and mistakes.", dysfunction: "trust", hint: "Is vulnerability safe in your team?" },
            { id: 7, text: "Team meetings are compelling and not boring.", dysfunction: "conflict", hint: "Are meetings engaging or dull?" },
            { id: 8, text: "Team members leave meetings confident that their peers are completely committed to the decisions that were agreed on, even if there was initial disagreement.", dysfunction: "commitment", hint: "Do decisions stick?" },
            { id: 9, text: "Morale is significantly affected by the failure to achieve team goals.", dysfunction: "results", hint: "Does team success matter to everyone?" },
            { id: 10, text: "During team meetings, the most important and difficult issues are put on the table to be resolved.", dysfunction: "conflict", hint: "Do you tackle the hard topics?" },
            { id: 11, text: "Team members are deeply concerned about the prospect of letting down their peers.", dysfunction: "accountability", hint: "Do people care about peer expectations?" },
            { id: 12, text: "Team members know about one another's personal lives and are comfortable discussing them.", dysfunction: "trust", hint: "Is there personal connection?" },
            { id: 13, text: "Team members end discussions with clear and specific resolutions and call to action.", dysfunction: "commitment", hint: "Are decisions clear and actionable?" },
            { id: 14, text: "Team members challenge one another about their plans and approaches.", dysfunction: "accountability", hint: "Do people constructively challenge each other?" },
            { id: 15, text: "Team members are slow to seek credit for their own contributions but quick to point out those of others.", dysfunction: "results", hint: "Who gets recognized - individuals or the team?" }
        ];

        const DYSFUNCTIONS = [
            { id: 'trust', name: 'Absence of Trust', shortName: 'Trust', statements: [4, 6, 12] },
            { id: 'conflict', name: 'Fear of Conflict', shortName: 'Conflict', statements: [1, 7, 10] },
            { id: 'commitment', name: 'Lack of Commitment', shortName: 'Commit', statements: [3, 8, 13] },
            { id: 'accountability', name: 'Avoidance of Accountability', shortName: 'Account', statements: [2, 11, 14] },
            { id: 'results', name: 'Inattention to Results', shortName: 'Results', statements: [5, 9, 15] }
        ];

        const BRAIN_JUICE_ACTIONS = {
            trust: ['Share personal stories at meeting start (5 min)', 'Monthly team-building vulnerability exercises', 'Quarterly strengths/weaknesses disclosure', 'Weekly check-ins promoting openness'],
            conflict: ['Establish norms for healthy debate', 'Create safe space with "devils advocate" role', 'Encourage diverse viewpoints round-robin', 'Real-time conflict resolution training'],
            commitment: ['"Disagree and commit" protocol', 'Decision clarity rounds at meeting end', 'Written commitment documentation', 'Regular commitment reviews'],
            accountability: ['Clear performance expectations documented', 'Peer-to-peer accountability partners', 'Regular progress reviews in meetings', 'Constructive call-out culture'],
            results: ['Align individual with team goals quarterly', 'Shared success metrics dashboard', 'Celebrate collective achievements', '"We over me" recognition programs']
        };

        const EXAMPLE_ASSESSMENT = {
            assessorName: "Sarah Chen",
            assessorRole: "CFO",
            responses: {
                1: 2, 2: 1, 3: 3, 4: 2, 5: 3,
                6: 2, 7: 2, 8: 1, 9: 3, 10: 2,
                11: 2, 12: 3, 13: 1, 14: 2, 15: 3
            }
        };

        // State
        let assessment = {
            assessorName: '',
            assessorRole: '',
            responses: {},
            scoresViewed: false
        };
        let actions = [
            { what: '', who: '', when: '' },
            { what: '', who: '', when: '' },
            { what: '', who: '', when: '' }
        ];
        let dysfunctionNotes = {};
        let currentTab = 'reference';

        // Initialize
        function init() {
            // Initialize empty responses for all 15 statements
            STATEMENTS.forEach(s => {
                assessment.responses[s.id] = 0;
            });
            updateProgress();
            
            // Enable start button when name is entered
            const nameInput = document.getElementById('assessor-name');
            if (nameInput) {
                nameInput.addEventListener('input', function() {
                    const startBtn = document.getElementById('start-assessment-btn');
                    if (startBtn) {
                        startBtn.disabled = !this.value.trim();
                    }
                });
            }
            
            ['assessor-name', 'assessor-role'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('change', updateProgress);
                if (el) el.addEventListener('input', updateProgress);
            });
            
            // Add keyboard listener for assessment
            document.addEventListener('keydown', handleKeyPress);
            
            // Add enter key listener for email login
            const emailInput = document.getElementById('user-email');
            if (emailInput) {
                emailInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        loginWithEmail();
                    }
                });
            }
        }

        // ================================================
        // USER LOGIN/LOGOUT
        // ================================================
        
        async function loginWithEmail() {
            const emailInput = document.getElementById('user-email');
            const email = emailInput?.value.trim();
            const statusEl = document.getElementById('login-status');
            
            if (!email) {
                statusEl.style.display = 'block';
                statusEl.style.color = 'var(--red)';
                statusEl.textContent = 'Please enter your email address';
                return;
            }
            
            // Show loading state
            statusEl.style.display = 'block';
            statusEl.style.color = 'var(--grey-600)';
            statusEl.textContent = 'Looking up your account...';
            
            try {
                const user = await lookupUserByEmail(email);
                
                if (user) {
                    // User found - enable online mode
                    currentUser = user;
                    currentCompany = user.companies;
                    isOnlineMode = true;
                    
                    // Update UI
                    document.getElementById('assessor-name').value = user.name;
                    document.getElementById('assessor-role').value = user.role || '';
                    
                    // Show logged in status
                    document.getElementById('email-login-section').style.display = 'none';
                    document.getElementById('or-divider').style.display = 'none';
                    document.getElementById('manual-entry-section').style.display = 'none';
                    
                    const loggedInStatus = document.getElementById('logged-in-status');
                    loggedInStatus.style.display = 'block';
                    document.getElementById('logged-in-name').textContent = user.name;
                    document.getElementById('logged-in-role').textContent = user.role ? ` - ${user.role}` : '';
                    document.getElementById('logged-in-company').textContent = currentCompany?.name || '';
                    
                    // Enable start button
                    document.getElementById('start-assessment-btn').disabled = false;
                    
                    // Show success toast
                    showToastMessage(` Welcome, ${user.name}! Your progress will be saved automatically.`);
                    
                    lucide.createIcons();
                } else {
                    // User not found
                    statusEl.style.color = 'var(--red)';
                    statusEl.innerHTML = `
                        <strong>Email not found.</strong><br>
                        <span style="color: var(--grey-600);">Ask your Guru to add you, or continue without login below.</span>
                    `;
                }
            } catch (error) {
                console.error('Login error:', error);
                statusEl.style.color = 'var(--red)';
                statusEl.textContent = 'Connection error. Please try again or continue without login.';
            }
        }
        
        function logoutUser() {
            currentUser = null;
            currentCompany = null;
            isOnlineMode = false;
            
            // Reset UI
            document.getElementById('email-login-section').style.display = 'block';
            document.getElementById('or-divider').style.display = 'flex';
            document.getElementById('manual-entry-section').style.display = 'block';
            document.getElementById('logged-in-status').style.display = 'none';
            document.getElementById('user-email').value = '';
            document.getElementById('login-status').style.display = 'none';
            
            // Clear name/role
            document.getElementById('assessor-name').value = '';
            document.getElementById('assessor-role').value = '';
            document.getElementById('start-assessment-btn').disabled = true;
            
            lucide.createIcons();
        }

        // ================================================
        // TYPEFORM-STYLE SLIDE ASSESSMENT
        // ================================================
        
        let currentSlide = 0;
        
        function startAssessment() {
            const nameInput = document.getElementById('assessor-name');
            if (!nameInput?.value.trim()) {
                nameInput.focus();
                return;
            }
            
            // Generate slides
            generateSlides();
            
            // Show fullscreen assessment
            document.getElementById('assessment-fullscreen').style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Show first slide
            currentSlide = 1;
            showSlide(1);
            updateSlideProgress();
            
            lucide.createIcons();
        }
        
        function generateSlides() {
            const container = document.getElementById('slides-container');
            container.innerHTML = STATEMENTS.map((stmt, index) => `
                <div id="slide-${index + 1}" class="assessment-slide ${index === 0 ? 'active' : ''}">
                    <div class="question-number-badge">${index + 1}</div>
                    
                    <h2 class="question-primary">${stmt.hint}</h2>
                    
                    <p class="question-context">${stmt.text}</p>
                    
                    <div class="answer-buttons">
                        <button class="answer-btn" onclick="answerQuestion(${stmt.id}, 1, this)" data-rating="1">
                            Rarely
                        </button>
                        <button class="answer-btn" onclick="answerQuestion(${stmt.id}, 2, this)" data-rating="2">
                            Sometimes
                        </button>
                        <button class="answer-btn" onclick="answerQuestion(${stmt.id}, 3, this)" data-rating="3">
                            Usually
                        </button>
                    </div>
                    
                    <div class="slide-nav">
                        <button class="btn-text-nav" onclick="prevSlide()" ${index === 0 ? 'disabled' : ''}>
                             Back
                        </button>
                        <button class="btn-text-nav" onclick="skipSlide()">
                            Skip 
                        </button>
                    </div>
                    
                    <div class="keyboard-hint">
                        Press <strong>1</strong>, <strong>2</strong>, or <strong>3</strong> to answer
                    </div>
                </div>
            `).join('');
        }
        
        function showSlide(num) {
            // Hide all slides
            document.querySelectorAll('.assessment-slide').forEach(s => {
                s.classList.remove('active');
                s.style.display = 'none';
            });
            
            // Show current slide
            const slide = document.getElementById(`slide-${num}`);
            if (slide) {
                slide.style.display = 'flex';
                slide.classList.add('active');
                
                // Restore any previous answer
                const existingAnswer = assessment.responses[num];
                if (existingAnswer) {
                    const btns = slide.querySelectorAll('.answer-btn');
                    btns.forEach(btn => {
                        btn.classList.remove('selected', 'selected-bad', 'selected-moderate', 'selected-good');
                        if (parseInt(btn.dataset.rating) === existingAnswer) {
                            const colorClass = existingAnswer === 1 ? 'selected-bad' : existingAnswer === 2 ? 'selected-moderate' : 'selected-good';
                            btn.classList.add('selected', colorClass);
                        }
                    });
                }
            }
        }
        
        function updateSlideProgress() {
            const progressText = document.getElementById('slide-progress-text');
            const progressFill = document.getElementById('slide-progress-fill');
            
            if (progressText) {
                progressText.textContent = `Question ${currentSlide} of 15`;
            }
            if (progressFill) {
                progressFill.style.width = `${(currentSlide / 15) * 100}%`;
            }
        }
        
        function answerQuestion(questionId, rating, btnElement) {
            assessment.responses[questionId] = rating;
            
            // Visual feedback
            const slide = btnElement.closest('.assessment-slide');
            slide.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected', 'selected-bad', 'selected-moderate', 'selected-good');
            });
            
            const colorClass = rating === 1 ? 'selected-bad' : rating === 2 ? 'selected-moderate' : 'selected-good';
            btnElement.classList.add('selected', colorClass);
            
            // Auto-advance after 400ms
            setTimeout(() => {
                if (currentSlide < 15) {
                    nextSlide();
                } else {
                    showResults();
                }
            }, 400);
        }
        
        function nextSlide() {
            if (currentSlide < 15) {
                currentSlide++;
                showSlide(currentSlide);
                updateSlideProgress();
            } else {
                showResults();
            }
        }
        
        function prevSlide() {
            if (currentSlide > 1) {
                currentSlide--;
                showSlide(currentSlide);
                updateSlideProgress();
            }
        }
        
        function skipSlide() {
            nextSlide();
        }
        
        function handleKeyPress(e) {
            // Only handle when assessment is visible
            if (document.getElementById('assessment-fullscreen').style.display !== 'block') return;
            if (document.getElementById('results-slide').style.display === 'flex') return;
            
            const slide = document.querySelector('.assessment-slide.active');
            if (!slide) return;
            
            if (e.key === '1' || e.key === '2' || e.key === '3') {
                const rating = parseInt(e.key);
                const stmtId = currentSlide;
                const btn = slide.querySelector(`.answer-btn[data-rating="${rating}"]`);
                if (btn) answerQuestion(stmtId, rating, btn);
            } else if (e.key === 'ArrowRight' || e.key === 'Enter') {
                if (assessment.responses[currentSlide]) {
                    nextSlide();
                }
            } else if (e.key === 'ArrowLeft') {
                prevSlide();
            } else if (e.key === 'Escape') {
                exitAssessment();
            }
        }
        
        async function showResults() {
            // Calculate scores
            const scores = calculateScores();
            const priorities = getPrioritiesForResults(scores);
            
            // Render results
            renderResults(priorities, scores);
            
            // Hide all question slides, show results
            document.querySelectorAll('.assessment-slide').forEach(s => {
                s.style.display = 'none';
                s.classList.remove('active');
            });
            
            document.getElementById('results-slide').style.display = 'flex';
            document.getElementById('results-slide').classList.add('active');
            
            // Hide the progress bar completely on results
            document.querySelector('.slide-progress-header').style.display = 'none';
            
            // Update FTP
            updateProgress();
            
            // Save to database if logged in
            if (isOnlineMode && currentUser) {
                const result = await saveAssessmentToDatabase();
                if (result.success) {
                    showToastMessage(' Assessment saved to database!');
                    // Update submission code section to show database mode
                    const codeCard = document.querySelector('.submission-code-card');
                    if (codeCard) {
                        codeCard.innerHTML = `
                            <div style="text-align: center; padding: 20px;">
                                <span class="icon icon-lg" style="color: var(--green);"><i data-lucide="cloud-check"></i></span>
                                <h4 style="margin-top: 12px; color: var(--green);">Saved to Database</h4>
                                <p style="color: var(--grey-600); margin-top: 8px; font-size: 13px;">
                                    Your Guru can see your results instantly in Guru Mode.<br>
                                    No code needed!
                                </p>
                                <div style="margin-top: 16px; padding: 12px; background: var(--grey-100); border-radius: 4px;">
                                    <span style="font-size: 12px; color: var(--grey-600);">Logged in as:</span><br>
                                    <strong>${currentUser.name}</strong> - ${currentCompany?.name || ''}
                                </div>
                            </div>
                        `;
                    }
                } else {
                    showToastMessage(' Could not save to database. Use code below.');
                }
            }
            
            lucide.createIcons();
        }
        
        function getPrioritiesForResults(scores) {
            return Object.entries(scores)
                .map(([id, score]) => {
                    const dysfunction = DYSFUNCTIONS.find(d => d.id === id);
                    return {
                        id,
                        name: dysfunction.name,
                        score,
                        status: score >= 8 ? 'healthy' : score >= 6 ? 'moderate' : 'critical',
                        insight: generateInsight(id, score)
                    };
                })
                .sort((a, b) => a.score - b.score)
                .slice(0, 3);
        }
        
        function generateInsight(dysfunctionId, score) {
            const insights = {
                trust: score < 6 ? "Low vulnerability. Build psychological safety first." : "Moderate trust. Continue vulnerability exercises.",
                conflict: score < 6 ? "Artificial harmony. Establish debate norms." : "Some healthy conflict. Encourage more.",
                commitment: score < 6 ? "Decisions don't stick. Team needs clarity protocols." : "Moderate commitment. Clarify decisions better.",
                accountability: score < 6 ? "Peers avoid confrontation. Create peer accountability culture." : "Some peer accountability. Make it systematic.",
                results: score < 6 ? "Individual focus trumps team goals. Realign incentives." : "Moderate team focus. Celebrate collective wins."
            };
            return insights[dysfunctionId] || "Needs attention.";
        }
        
        function renderResults(priorities, scores) {
            // Render priority boxes
            const prioritiesContainer = document.getElementById('results-priorities');
            prioritiesContainer.innerHTML = priorities.map((p, i) => `
                <div class="priority-box ${p.status}">
                    <div class="priority-label">Priority #${i + 1}</div>
                    <h3>${p.name}</h3>
                    <div class="priority-score">${p.score}/9</div>
                    <p class="priority-insight">${p.insight}</p>
                </div>
            `).join('');
            
            // Render key insight
            const topPriority = priorities[0];
            document.getElementById('results-insight-text').innerHTML = 
                `Your team's biggest gap is <strong>${topPriority.name.toLowerCase()}</strong> (${topPriority.score}/9). ${topPriority.insight} This is where you should focus your action planning.`;
        }
        
        function exitAssessment() {
            document.getElementById('assessment-fullscreen').style.display = 'none';
            document.body.style.overflow = '';
        }
        
        function exitAndGoToAction() {
            exitAssessment();
            showTab('action');
            renderActionTab();
        }
        
        function loadExampleAssessment() {
            // Load example data
            const example = {
                1: 2, 2: 1, 3: 3, 4: 2, 5: 3,
                6: 2, 7: 2, 8: 1, 9: 3, 10: 2,
                11: 2, 12: 3, 13: 1, 14: 2, 15: 3
            };
            
            Object.entries(example).forEach(([id, rating]) => {
                assessment.responses[parseInt(id)] = rating;
            });
            
            document.getElementById('assessor-name').value = 'Sarah Chen';
            document.getElementById('assessor-role').value = 'CFO';
            
            // Enable and click start
            document.getElementById('start-assessment-btn').disabled = false;
            startAssessment();
            
            // Jump to results
            setTimeout(() => showResults(), 100);
        }

        // Reference Slide Navigation
        let currentRefSlide = 1;
        
        function nextRefSlide() {
            document.getElementById('ref-slide-' + currentRefSlide).classList.remove('active');
            currentRefSlide = 2;
            document.getElementById('ref-slide-' + currentRefSlide).classList.add('active');
            lucide.createIcons();
        }
        
        function prevRefSlide() {
            document.getElementById('ref-slide-' + currentRefSlide).classList.remove('active');
            currentRefSlide = 1;
            document.getElementById('ref-slide-' + currentRefSlide).classList.add('active');
            lucide.createIcons();
        }

        // Tab Navigation
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            // Find and activate the corresponding tab button
            const tabBtn = document.getElementById('tab-' + tabId);
            if (tabBtn) {
                tabBtn.classList.add('active');
            } else if (event && event.target) {
                const clickedTab = event.target.closest('.tab-btn');
                if (clickedTab) clickedTab.classList.add('active');
            }
            
            currentTab = tabId;
            
            if (tabId === 'scores') {
                assessment.scoresViewed = true;
                renderScoresTab();
            }
            if (tabId === 'action') renderActionTab();
            if (tabId === 'dashboard') renderDashboard();
            
            updateProgress();
            lucide.createIcons();
            window.scrollTo(0, 0);
        }

        // Helpers - New scoring for 1-3 scale (max 9 per dysfunction)
        function getStatus(score) {
            if (score >= 8) return 'healthy';
            if (score >= 6) return 'moderate';
            return 'critical';
        }

        function getStatusLabel(score) {
            if (score >= 8) return 'NO PROBLEM';
            if (score >= 6) return 'POSSIBLE PROBLEM';
            return 'SERIOUS PROBLEM';
        }

        function getRatingLabel(rating) {
            if (rating === 3) return 'Usually';
            if (rating === 2) return 'Sometimes';
            if (rating === 1) return 'Rarely';
            return '-';
        }

        function getRatingStatus(rating) {
            if (rating === 3) return 'good';
            if (rating === 2) return 'moderate';
            if (rating === 1) return 'bad';
            return '';
        }

        // Calculate dysfunction scores from statement responses
        function calculateScores() {
            const scores = {};
            DYSFUNCTIONS.forEach(d => {
                const stmtScores = d.statements.map(id => assessment.responses[id] || 0);
                scores[d.id] = stmtScores.reduce((a, b) => a + b, 0);
            });
            return scores;
        }

        function calcAverage(arr) {
            const valid = arr.filter(v => v > 0);
            return valid.length ? valid.reduce((a, b) => a + b, 0) / valid.length : 0;
        }

        // Render 15 Statement Cards
        function renderStatements() {
            const container = document.getElementById('statements-container');
            if (!container) return;
            
            container.innerHTML = STATEMENTS.map(stmt => {
                const currentRating = assessment.responses[stmt.id] || 0;
                const isComplete = currentRating > 0;
                
                return `
                    <div class="statement-card ${isComplete ? 'completed' : ''}" id="statement-card-${stmt.id}">
                        <!-- Header with number + hint question (no dysfunction label) -->
                        <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px;">
                            <div class="statement-number">${stmt.id}</div>
                            <div style="flex: 1;">
                                <div style="font-size: 18px; color: var(--grey-900); margin-bottom: 12px; display: flex; align-items: center; gap: 10px; line-height: 1.5; font-weight: 600;">
                                    <span class="icon icon-md" style="color: var(--yellow-600);"><i data-lucide="lightbulb"></i></span>
                                    ${stmt.hint}
                                </div>
                                <div style="font-size: 11px; line-height: 1.7; color: var(--grey-600);">
                                    ${stmt.text}
                                </div>
                            </div>
                            ${isComplete ? '<span class="icon icon-sm" style="color: var(--green); flex-shrink: 0;"><i data-lucide="check-circle"></i></span>' : ''}
                        </div>
                        
                        <!-- Rating buttons WITHOUT numbers -->
                        <div class="rating-buttons">
                            <button class="rating-btn ${currentRating === 1 ? 'active rating-bad' : ''}" onclick="rateStatement(${stmt.id}, 1)">
                                <span class="rating-label-only">Rarely</span>
                            </button>
                            <button class="rating-btn ${currentRating === 2 ? 'active rating-moderate' : ''}" onclick="rateStatement(${stmt.id}, 2)">
                                <span class="rating-label-only">Sometimes</span>
                            </button>
                            <button class="rating-btn ${currentRating === 3 ? 'active rating-good' : ''}" onclick="rateStatement(${stmt.id}, 3)">
                                <span class="rating-label-only">Usually</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        function rateStatement(statementId, rating) {
            assessment.responses[statementId] = rating;
            
            // Flash animation
            const card = document.getElementById(`statement-card-${statementId}`);
            if (card) {
                card.style.background = 'var(--yellow-100)';
                setTimeout(() => {
                    card.style.background = '';
                    card.classList.add('completed');
                }, 200);
            }
            
            renderStatements();
            updateProgress();
            showToast();
        }

        function showToast() {
            const completed = Object.values(assessment.responses).filter(r => r > 0).length;
            const assessorName = document.getElementById('assessor-name')?.value.trim();
            
            if (completed === 15 && assessorName) {
                // Show completion toast
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.innerHTML = ' Assessment Complete! +25 FTP';
                toast.style.cssText = 'position:fixed;top:80px;right:24px;background:var(--green);color:white;padding:16px 24px;border-radius:4px;z-index:1000;font-weight:600;animation:slideIn 0.3s ease;';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        }

        function isAssessmentComplete() {
            const completed = Object.values(assessment.responses).filter(r => r > 0).length;
            const assessorName = document.getElementById('assessor-name')?.value.trim();
            return completed === 15 && assessorName;
        }

        // Progress
        function updateProgress() {
            const completed = Object.values(assessment.responses).filter(r => r > 0).length;
            const assessorName = document.getElementById('assessor-name')?.value.trim();
            const assessmentComplete = completed === 15 && assessorName;
            
            // Update progress display
            const statementsCount = document.getElementById('statements-count');
            const completionPct = document.getElementById('completion-pct');
            const ftpProgress = document.getElementById('ftp-progress');
            const assessmentStatus = document.getElementById('assessment-status');
            
            if (statementsCount) statementsCount.textContent = `${completed}/15`;
            if (completionPct) completionPct.textContent = `${Math.round((completed/15)*100)}%`;
            if (ftpProgress) ftpProgress.textContent = `+${assessmentComplete ? 25 : 0}`;
            if (assessmentStatus) {
                assessmentStatus.textContent = assessmentComplete ? 'Complete!' : 'In Progress';
                assessmentStatus.style.color = assessmentComplete ? 'var(--green)' : 'var(--amber)';
            }
            
            // Quick View with live scores
            const quickView = document.getElementById('quick-view');
            const quickItems = document.getElementById('quick-view-items');
            const scores = calculateScores();
            
            if (quickView && quickItems && completed > 0) {
                quickView.style.display = 'flex';
                quickItems.innerHTML = DYSFUNCTIONS.map(d => {
                    const hasAllStatements = d.statements.every(id => assessment.responses[id] > 0);
                    if (!hasAllStatements) return '';
                    return `
                        <div class="quick-view-item">
                            <span>${d.shortName}</span>
                            <span>${scores[d.id]}/9</span>
                            <div class="traffic-light ${getStatus(scores[d.id])}"></div>
                        </div>
                    `;
                }).join('');
            } else if (quickView) {
                quickView.style.display = 'none';
            }
            
            // Tab: Your Scores - unlocks when assessment complete
            const scoresTab = document.getElementById('tab-scores');
            const viewScoresBtn = document.getElementById('view-scores-btn');
            if (scoresTab) {
                scoresTab.disabled = !assessmentComplete;
                scoresTab.innerHTML = assessmentComplete 
                    ? '<span class="icon icon-sm"><i data-lucide="check-circle"></i></span> Your Scores'
                    : '<span class="icon icon-sm"><i data-lucide="lock"></i></span> Your Scores';
            }
            if (viewScoresBtn) viewScoresBtn.disabled = !assessmentComplete;
            
            // Tab: Action Plan - unlocks when scores viewed
            const actionTab = document.getElementById('tab-action');
            if (actionTab) {
                actionTab.disabled = !assessment.scoresViewed;
                actionTab.innerHTML = assessment.scoresViewed 
                    ? '<span class="icon icon-sm"><i data-lucide="check-circle"></i></span> Action Plan'
                    : '<span class="icon icon-sm"><i data-lucide="lock"></i></span> Action Plan';
            }
            
            // Tab: Dashboard - unlocks when commitment signed
            const dashboardComplete = checkDashboardComplete();
            const dashboardTab = document.getElementById('tab-dashboard');
            const viewDashboardBtn = document.getElementById('view-dashboard-btn');
            if (dashboardTab) {
                dashboardTab.disabled = !dashboardComplete;
                dashboardTab.innerHTML = dashboardComplete 
                    ? '<span class="icon icon-sm"><i data-lucide="check-circle"></i></span> Dashboard'
                    : '<span class="icon icon-sm"><i data-lucide="lock"></i></span> Dashboard';
            }
            if (viewDashboardBtn) viewDashboardBtn.disabled = !dashboardComplete;
            
            // FTP Display
            const ftp = calculateFTP();
            const ftpCount = document.getElementById('ftp-count');
            if (ftpCount) ftpCount.textContent = `${ftp} FTP`;
            
            lucide.createIcons();
        }

        function checkDashboardComplete() {
            // Must complete all 3 WWW actions
            const allActionsComplete = actions.slice(0, 3).every(a => a.what && a.who && a.when);
            return allActionsComplete;
        }

        function calculateFTP() {
            let ftp = 0;
            // Assessment complete: +25
            if (isAssessmentComplete()) ftp += 25;
            // Each action complete: +25 (max 75)
            actions.forEach(a => {
                if (a.action && a.owner && a.frequency && a.startDate && a.successMetric) ftp += 25;
            });
            return ftp;
        }

        // Render Your Scores Tab
        function renderScoresTab() {
            const scores = calculateScores();
            const sorted = Object.entries(scores)
                .map(([id, score]) => ({
                    ...DYSFUNCTIONS.find(d => d.id === id),
                    score
                }))
                .sort((a, b) => a.score - b.score); // Lowest first (worst problems)
            
            const container = document.getElementById('dysfunction-scores-summary');
            if (!container) return;
            
            // Calculate key insights
            const criticalCount = sorted.filter(d => d.score < 6).length;
            const topPriority = sorted[0];
            const avgScore = (Object.values(scores).reduce((a, b) => a + b, 0) / 5).toFixed(1);
            
            container.innerHTML = `
                <div style="background: var(--grey-50); padding: 24px; border-radius: 8px; margin-bottom: 24px;">
                    <h4 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <span class="icon icon-sm"><i data-lucide="lightbulb"></i></span>
                        Key Findings
                    </h4>
                    <p style="color: var(--grey-700); line-height: 1.8; margin: 0;">
                        Your team has <strong>${criticalCount} critical dysfunction${criticalCount !== 1 ? 's' : ''}</strong> requiring immediate attention. 
                        The top priority is <strong>${topPriority.name}</strong> (${topPriority.score}/9), which needs focused improvement. 
                        Your overall team health score is <strong>${avgScore}/9</strong>.
                    </p>
                </div>
                
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--grey-900); color: white;">
                            <th style="padding: 12px 16px; text-align: left; font-weight: 600;">Dysfunction</th>
                            <th style="padding: 12px 16px; text-align: center; width: 100px; font-weight: 600;">Score</th>
                            <th style="padding: 12px 16px; text-align: center; width: 120px; font-weight: 600;">Status</th>
                            <th style="padding: 12px 16px; text-align: center; width: 100px; font-weight: 600;">Priority</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sorted.map((d, index) => `
                            <tr style="border-bottom: 1px solid var(--grey-200);">
                                <td style="padding: 16px; font-weight: 600;">
                                    ${d.name}
                                </td>
                                <td style="padding: 16px; text-align: center; font-weight: 700; font-size: 18px; color: var(--${d.score >= 8 ? 'green' : d.score >= 6 ? 'amber' : 'red'});">
                                    ${d.score}/9
                                </td>
                                <td style="padding: 16px; text-align: center;">
                                    <span style="display: inline-block; padding: 4px 12px; border-radius: 4px; font-size: 11px; font-weight: 700; background: var(--${d.score >= 8 ? 'green' : d.score >= 6 ? 'amber' : 'red'}); color: white;">
                                        ${getStatusLabel(d.score)}
                                    </span>
                                </td>
                                <td style="padding: 16px; text-align: center;">
                                    ${index < 3 ? `<span style="display: inline-block; padding: 4px 12px; border-radius: 4px; font-size: 11px; font-weight: 700; background: var(--yellow-400);">#${index + 1}</span>` : ''}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            lucide.createIcons();
            
            // Update submission code display
            updateSubmissionCodeDisplay();
        }

        // Action Tab
        function renderActionTab() {
            const scores = calculateScores();
            
            // Sort dysfunctions by score (lowest first = worst problems)
            const sortedDysfunctions = DYSFUNCTIONS
                .map(d => ({ ...d, score: scores[d.id] }))
                .sort((a, b) => a.score - b.score);
            
            // Render ALL 5 dysfunctions table
            const tableContainer = document.getElementById('dysfunction-action-table');
            if (tableContainer) {
                tableContainer.innerHTML = `
                    <table class="www-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--grey-900); color: white;">
                                <th style="padding: 12px 16px; text-align: left; font-weight: 600;">Dysfunction</th>
                                <th style="padding: 12px 16px; text-align: center; width: 80px; font-weight: 600;">Score</th>
                                <th style="padding: 12px 16px; text-align: left; font-weight: 600;">How can it be addressed</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedDysfunctions.map((d, i) => `
                                <tr style="border-bottom: 1px solid var(--grey-200);">
                                    <td style="padding: 16px; font-weight: 600; vertical-align: top;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="width: 10px; height: 10px; border-radius: 50%; background: var(--${d.score >= 8 ? 'green' : d.score >= 6 ? 'amber' : 'red'});"></span>
                                            ${d.name.toUpperCase()}
                                        </div>
                                    </td>
                                    <td style="padding: 16px; text-align: center; font-weight: 700; color: var(--${d.score >= 8 ? 'green' : d.score >= 6 ? 'amber' : 'red'});">
                                        ${d.score}/9
                                    </td>
                                    <td style="padding: 8px;">
                                        <textarea 
                                            id="dysfunction-notes-${d.id}"
                                            placeholder="Discuss as a team how to address this..."
                                            style="width: 100%; min-height: 60px; border: 1px solid var(--grey-300); border-radius: 4px; padding: 8px; font-family: inherit; font-size: 13px; resize: vertical;"
                                        >${dysfunctionNotes[d.id] || ''}</textarea>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                
                // Add event listeners for notes
                sortedDysfunctions.forEach(d => {
                    const textarea = document.getElementById(`dysfunction-notes-${d.id}`);
                    if (textarea) {
                        textarea.addEventListener('input', (e) => {
                            dysfunctionNotes[d.id] = e.target.value;
                        });
                    }
                });
            }
            
            // Ensure we have 3 action slots
            while (actions.length < 3) {
                actions.push({ what: '', who: '', when: '' });
            }
            
            // Render 3 simple WWW action rows
            const actionsContainer = document.getElementById('www-actions-container');
            if (actionsContainer) {
                actionsContainer.innerHTML = `
                    <table class="www-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--grey-900); color: white;">
                                <th style="padding: 12px 16px; text-align: left; font-weight: 600;">What</th>
                                <th style="padding: 12px 16px; text-align: left; width: 180px; font-weight: 600;">Who</th>
                                <th style="padding: 12px 16px; text-align: left; width: 150px; font-weight: 600;">When</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${[0, 1, 2].map(i => `
                                <tr style="border-bottom: 1px solid var(--grey-200);">
                                    <td style="padding: 8px;">
                                        <textarea 
                                            placeholder="Specific action to take..."
                                            onchange="updateWWW(${i}, 'what', this.value)"
                                            oninput="updateWWW(${i}, 'what', this.value)"
                                            style="width: 100%; min-height: 50px; border: 1px solid var(--grey-300); border-radius: 4px; padding: 8px; font-family: inherit; font-size: 13px; resize: vertical;"
                                        >${actions[i]?.what || ''}</textarea>
                                    </td>
                                    <td style="padding: 8px;">
                                        <input 
                                            type="text"
                                            placeholder="Team Leader"
                                            value="${actions[i]?.who || ''}"
                                            onchange="updateWWW(${i}, 'who', this.value)"
                                            oninput="updateWWW(${i}, 'who', this.value)"
                                            style="width: 100%; border: 1px solid var(--grey-300); border-radius: 4px; padding: 10px; font-family: inherit; font-size: 13px;"
                                        >
                                    </td>
                                    <td style="padding: 8px;">
                                        <input 
                                            type="text"
                                            placeholder="Next week"
                                            value="${actions[i]?.when || ''}"
                                            onchange="updateWWW(${i}, 'when', this.value)"
                                            oninput="updateWWW(${i}, 'when', this.value)"
                                            style="width: 100%; border: 1px solid var(--grey-300); border-radius: 4px; padding: 10px; font-family: inherit; font-size: 13px;"
                                        >
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            // Check if all 3 actions are complete
            const allActionsComplete = actions.slice(0, 3).every(a => a.what && a.who && a.when);
            
            lucide.createIcons();
        }

        function isActionComplete(index) {
            const a = actions[index];
            return a && a.what && a.who && a.when;
        }

        function addAction() {
            // No longer needed - we have exactly 3 fixed actions
        }

        function removeAction(index) {
            // Only allow removing non-priority actions (index >= 3)
            if (index >= 3 && actions.length > 3) {
                actions.splice(index, 1);
                renderActionTab();
                updateProgress();
                lucide.createIcons();
            }
        }

        // Debounce timer for database saves
        let actionSaveTimeout = null;
        
        function updateWWW(index, field, value) {
            if (!actions[index]) actions[index] = { what: '', who: '', when: '' };
            actions[index][field] = value;
            
            updateProgress();
            
            // Debounced save to database (waits 1 second after typing stops)
            if (isOnlineMode && currentCompany) {
                clearTimeout(actionSaveTimeout);
                actionSaveTimeout = setTimeout(() => {
                    saveActionsToDatabase();
                }, 1000);
            }
        }

        function updateAction(index, field, value) {
            actions[index][field] = value;
            updateProgress();
        }

        // Dashboard
        function renderDashboard() {
            const scores = calculateScores();
            const totalScore = Object.values(scores).reduce((a, b) => a + b, 0);
            const overallScore = totalScore / 5; // Average of 5 dysfunctions
            const criticalCount = DYSFUNCTIONS.filter(d => scores[d.id] < 6).length;
            const ftp = calculateFTP();
            const actionsCount = actions.filter((a, i) => isActionComplete(i)).length;
            
            document.getElementById('overall-score').textContent = overallScore.toFixed(1);
            document.getElementById('critical-count').textContent = criticalCount;
            document.getElementById('critical-icon-wrap').style.color = criticalCount > 0 ? 'var(--red)' : 'var(--green)';
            document.getElementById('actions-count').textContent = actionsCount;
            document.getElementById('ftp-earned').textContent = `+${ftp}`;
            
            const masteryLevel = ftp < 200 ? 'NOVICE' : ftp < 500 ? 'PRACTITIONER' : 'MASTER';
            const nextLevelFTP = masteryLevel === 'NOVICE' ? 200 : 500;
            const progress = Math.min((ftp / nextLevelFTP) * 100, 100);
            
            document.getElementById('mastery-level').textContent = masteryLevel;
            document.getElementById('mastery-ftp').textContent = ftp;
            document.getElementById('mastery-progress').style.width = `${progress}%`;
            document.getElementById('mastery-next').textContent = `${nextLevelFTP - ftp} more FTP needed for ${masteryLevel === 'NOVICE' ? 'PRACTITIONER' : 'MASTER'} level`;
            
            // Heat map shows YOUR scores (single row)
            const heatMapBody = document.getElementById('heat-map-body');
            const assessorName = document.getElementById('assessor-name')?.value || 'You';
            const assessorRole = document.getElementById('assessor-role')?.value || 'Team Member';
            heatMapBody.innerHTML = `
                <tr>
                    <td>${assessorName}</td>
                    <td>${assessorRole}</td>
                    ${DYSFUNCTIONS.map(d => `<td><span class="heat-cell ${getStatus(scores[d.id])}">${scores[d.id]}/9</span></td>`).join('')}
                </tr>
            `;
            
            document.getElementById('chart-bars').innerHTML = DYSFUNCTIONS.map(d => `
                <div class="chart-bar-item">
                    <div class="chart-bar-label">${d.shortName}</div>
                    <div class="chart-bar-track">
                        <div class="chart-bar-fill ${getStatus(scores[d.id])}" style="width: ${(scores[d.id] / 9) * 100}%">${scores[d.id]}/9</div>
                    </div>
                </div>
            `).join('');
            
            const tracker = document.getElementById('action-tracker');
            tracker.innerHTML = `
                <div class="action-tracker-row">
                    <div>Dysfunction</div>
                    <div>Action</div>
                    <div>Owner</div>
                    <div>Start</div>
                    <div>Status</div>
                </div>
            ` + actions.filter(a => a.action).map(a => {
                const dysfunction = DYSFUNCTIONS.find(d => d.id === a.dysfunctionId);
                return `
                    <div class="action-tracker-row">
                        <div>${dysfunction?.shortName || '-'}</div>
                        <div style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${a.action}</div>
                        <div>${a.owner?.split(' - ')[0] || '-'}</div>
                        <div>${a.startDate || '-'}</div>
                        <div><span class="status-badge">Not Started</span></div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('final-forum-date').textContent = document.getElementById('forum-date')?.value || 'Not set';
            document.getElementById('final-team-date').textContent = document.getElementById('team-share-date')?.value || 'Not set';
            document.getElementById('final-guru-date').textContent = document.getElementById('guru-review-date')?.value || 'Scheduled';
            
            lucide.createIcons();
        }

        // Load Example Assessment
        function loadExample() {
            assessment.assessorName = EXAMPLE_ASSESSMENT.assessorName;
            assessment.assessorRole = EXAMPLE_ASSESSMENT.assessorRole;
            assessment.responses = { ...EXAMPLE_ASSESSMENT.responses };
            
            document.getElementById('assessor-name').value = EXAMPLE_ASSESSMENT.assessorName;
            document.getElementById('assessor-role').value = EXAMPLE_ASSESSMENT.assessorRole;
            
            renderStatements();
            updateProgress();
        }
        
        function loadExampleAndHide() {
            loadExample();
            hideExamplePrompt();
            // Scroll to first statement card
            const firstCard = document.querySelector('.statement-card');
            if (firstCard) {
                setTimeout(() => {
                    firstCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }
        
        function hideExamplePrompt() {
            const prompt = document.getElementById('example-prompt');
            if (prompt) {
                prompt.style.transition = 'all 0.3s ease';
                prompt.style.opacity = '0';
                prompt.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    prompt.style.display = 'none';
                }, 300);
            }
        }

        // Copy Link
        function copyLink() {
            const data = { assessment, actions };
            const encoded = btoa(JSON.stringify(data));
            navigator.clipboard.writeText(`${window.location.href}#data=${encoded}`).then(() => {
                alert('Assessment link copied! Share with your Guru or Forum peers.');
            });
        }

        // ================================================
        // GURU MODE FUNCTIONS
        // ================================================
        
        const GURU_CODE = 'TEAM-SPRINT-05'; // Sprint-specific code
        let teamAssessments = []; // Array to store imported team assessments
        
        function openGuruModal() {
            document.getElementById('guru-modal').classList.add('active');
            document.getElementById('guru-code-input').value = '';
            document.getElementById('guru-code-error').style.display = 'none';
            document.getElementById('guru-code-input').focus();
        }
        
        function closeGuruModal() {
            document.getElementById('guru-modal').classList.remove('active');
        }
        
        function validateGuruCode() {
            const input = document.getElementById('guru-code-input').value.trim().toUpperCase();
            if (input === GURU_CODE) {
                closeGuruModal();
                openGuruMode();
            } else {
                document.getElementById('guru-code-error').style.display = 'block';
                document.getElementById('guru-code-input').select();
            }
        }
        
        async function openGuruMode() {
            document.getElementById('guru-fullscreen').classList.add('active');
            document.body.style.overflow = 'hidden';
            renderImportedList();
            
            // Load companies for dropdown
            await loadCompaniesDropdown();
            
            lucide.createIcons();
        }
        
        function closeGuruMode() {
            document.getElementById('guru-fullscreen').classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // Load companies into dropdown
        async function loadCompaniesDropdown() {
            const select = document.getElementById('company-select');
            if (!select) return;
            
            const companies = await getAllCompanies();
            
            select.innerHTML = '<option value="">Select a company...</option>';
            companies.forEach(company => {
                const option = document.createElement('option');
                option.value = company.id;
                option.textContent = `${company.name}${company.guru_name ? ` (Guru: ${company.guru_name})` : ''}`;
                select.appendChild(option);
            });
        }
        
        // Load assessments from database for selected company
        async function loadCompanyAssessments() {
            const select = document.getElementById('company-select');
            const statusEl = document.getElementById('db-load-status');
            const companyId = select?.value;
            
            if (!companyId) {
                statusEl.style.display = 'block';
                statusEl.style.color = 'var(--red)';
                statusEl.textContent = 'Please select a company';
                return;
            }
            
            // Show loading
            statusEl.style.display = 'block';
            statusEl.style.color = 'var(--grey-600)';
            statusEl.textContent = 'Loading team assessments...';
            
            try {
                const assessments = await loadTeamAssessmentsFromDatabase(companyId);
                
                if (assessments.length === 0) {
                    statusEl.style.color = 'var(--amber)';
                    statusEl.textContent = 'No assessments found for this company yet.';
                    return;
                }
                
                // Clear existing and add from database
                teamAssessments = assessments;
                
                // Update UI
                renderImportedList();
                
                if (teamAssessments.length >= 2) {
                    renderTeamSummary();
                }
                
                statusEl.style.color = 'var(--green)';
                statusEl.textContent = ` Loaded ${assessments.length} assessment(s) from database!`;
                
                showToastMessage(` Loaded ${assessments.length} team assessments`);
                
            } catch (error) {
                console.error('Load error:', error);
                statusEl.style.color = 'var(--red)';
                statusEl.textContent = 'Error loading assessments. Please try again.';
            }
        }
        
        // Generate submission code from current assessment
        function generateSubmissionCode() {
            const scores = calculateScores();
            const data = {
                name: document.getElementById('assessor-name')?.value || 'Unknown',
                role: document.getElementById('assessor-role')?.value || '',
                timestamp: new Date().toISOString(),
                scores: scores,
                responses: assessment.responses
            };
            return btoa(JSON.stringify(data));
        }
        
        function copySubmissionCode() {
            const code = generateSubmissionCode();
            navigator.clipboard.writeText(code).then(() => {
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span class="icon icon-sm"><i data-lucide="check"></i></span> Copied!';
                btn.style.background = 'var(--green)';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                    lucide.createIcons();
                }, 2000);
            });
        }
        
        // Update submission code display when scores tab is shown
        function updateSubmissionCodeDisplay() {
            const codeEl = document.getElementById('submission-code');
            if (codeEl) {
                codeEl.textContent = generateSubmissionCode();
            }
        }
        
        // Import assessment from code
        function importAssessment() {
            const input = document.getElementById('import-code-input');
            const code = input.value.trim();
            
            if (!code) {
                alert('Please paste a submission code');
                return;
            }
            
            try {
                const data = JSON.parse(atob(code));
                
                // Validate data structure
                if (!data.name || !data.scores) {
                    throw new Error('Invalid code format');
                }
                
                // Check for duplicate
                if (teamAssessments.find(a => a.name === data.name)) {
                    alert(`${data.name} has already been imported`);
                    return;
                }
                
                // Add to array
                teamAssessments.push(data);
                
                // Clear input
                input.value = '';
                
                // Update UI
                renderImportedList();
                
                // Show summary if 2+ members
                if (teamAssessments.length >= 2) {
                    renderTeamSummary();
                }
                
                // Show success feedback
                showToastMessage(` ${data.name} imported successfully`);
                
            } catch (e) {
                alert('Invalid submission code. Please check and try again.');
                console.error('Import error:', e);
            }
        }
        
        function removeImportedMember(index) {
            teamAssessments.splice(index, 1);
            renderImportedList();
            if (teamAssessments.length >= 2) {
                renderTeamSummary();
            } else {
                document.getElementById('team-summary-section').style.display = 'none';
            }
        }
        
        function renderImportedList() {
            const container = document.getElementById('imported-members');
            const countEl = document.getElementById('imported-count');
            
            countEl.textContent = teamAssessments.length;
            
            if (teamAssessments.length === 0) {
                container.innerHTML = '<p style="color: var(--grey-500); font-style: italic;">No team members imported yet</p>';
            } else {
                container.innerHTML = teamAssessments.map((member, index) => `
                    <div class="imported-item success">
                        <div>
                            <span class="name">${member.name}</span>
                            ${member.role ? `<span class="role"> - ${member.role}</span>` : ''}
                        </div>
                        <button onclick="removeImportedMember(${index})" style="background: none; border: none; cursor: pointer; color: var(--grey-400);">
                            <span class="icon icon-sm"><i data-lucide="x"></i></span>
                        </button>
                    </div>
                `).join('');
            }
            
            lucide.createIcons();
        }
        
        function renderTeamSummary() {
            if (teamAssessments.length < 2) return;
            
            document.getElementById('team-summary-section').style.display = 'block';
            
            // Calculate team averages
            const teamAverages = {};
            const varianceData = {};
            
            DYSFUNCTIONS.forEach(d => {
                const scores = teamAssessments.map(a => a.scores[d.id] || 0);
                const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
                const min = Math.min(...scores);
                const max = Math.max(...scores);
                
                teamAverages[d.id] = {
                    avg: avg.toFixed(1),
                    min: min,
                    max: max,
                    range: max - min,
                    status: avg >= 8 ? 'healthy' : avg >= 6 ? 'moderate' : 'critical'
                };
                
                varianceData[d.id] = { range: max - min, min, max };
            });
            
            // Render priorities
            const sorted = Object.entries(teamAverages)
                .map(([id, data]) => ({ id, ...DYSFUNCTIONS.find(d => d.id === id), ...data }))
                .sort((a, b) => parseFloat(a.avg) - parseFloat(b.avg));
            
            const prioritiesContainer = document.getElementById('team-priorities');
            prioritiesContainer.innerHTML = sorted.slice(0, 3).map((d, i) => `
                <div class="priority-summary-card ${d.status}">
                    <h4>PRIORITY #${i + 1}</h4>
                    <h3>${d.name}</h3>
                    <div class="score">${d.avg}/9</div>
                </div>
            `).join('');
            
            // Render variance alerts
            const alertsContainer = document.getElementById('variance-alerts');
            const highVariance = Object.entries(varianceData)
                .filter(([id, data]) => data.range >= 3)
                .map(([id, data]) => ({ id, ...DYSFUNCTIONS.find(d => d.id === id), ...data }));
            
            if (highVariance.length > 0) {
                alertsContainer.innerHTML = `
                    <h3 style="margin-bottom: 16px;">
                        <span class="icon icon-md"><i data-lucide="alert-triangle"></i></span>
                        Variance Alerts
                    </h3>
                    ${highVariance.map(d => `
                        <div class="variance-alert">
                            <h4>
                                <span class="icon icon-sm"><i data-lucide="alert-triangle"></i></span>
                                High Variance: ${d.name}
                            </h4>
                            <p>
                                Scores range from <strong>${d.min}</strong> to <strong>${d.max}</strong> (${d.range} point spread).
                                This disagreement is worth discussing with the team.
                            </p>
                        </div>
                    `).join('')}
                `;
            } else {
                alertsContainer.innerHTML = '';
            }
            
            // Render table
            const table = document.getElementById('team-summary-table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Team Member</th>
                        ${DYSFUNCTIONS.map(d => `<th>${d.shortName}</th>`).join('')}
                    </tr>
                </thead>
                <tbody>
                    ${teamAssessments.map(member => `
                        <tr>
                            <td>${member.name}${member.role ? ` <span style="color: var(--grey-500); font-weight: 400;">(${member.role})</span>` : ''}</td>
                            ${DYSFUNCTIONS.map(d => {
                                const score = member.scores[d.id] || 0;
                                const status = score >= 8 ? 'healthy' : score >= 6 ? 'moderate' : 'critical';
                                return `<td class="score-cell ${status}">${score}</td>`;
                            }).join('')}
                        </tr>
                    `).join('')}
                    <tr class="average-row">
                        <td>TEAM AVERAGE</td>
                        ${DYSFUNCTIONS.map(d => {
                            const data = teamAverages[d.id];
                            return `<td class="score-cell ${data.status}">${data.avg}</td>`;
                        }).join('')}
                    </tr>
                </tbody>
            `;
            
            lucide.createIcons();
        }
        
        function copyTeamSummary() {
            if (teamAssessments.length < 2) return;
            
            // Calculate averages
            const teamAverages = {};
            DYSFUNCTIONS.forEach(d => {
                const scores = teamAssessments.map(a => a.scores[d.id] || 0);
                teamAverages[d.id] = (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1);
            });
            
            // Build text summary
            let summary = `TEAM DYSFUNCTION SUMMARY\n`;
            summary += `Sprint 5 - ${teamAssessments.length} Team Members\n`;
            summary += `${'='.repeat(50)}\n\n`;
            
            summary += `INDIVIDUAL SCORES:\n`;
            summary += `-`.repeat(50) + `\n`;
            teamAssessments.forEach(m => {
                summary += `${m.name} (${m.role || 'N/A'}): `;
                summary += DYSFUNCTIONS.map(d => `${d.shortName}: ${m.scores[d.id]}`).join(' | ');
                summary += `\n`;
            });
            
            summary += `\nTEAM AVERAGES:\n`;
            summary += `-`.repeat(50) + `\n`;
            DYSFUNCTIONS.forEach(d => {
                const avg = teamAverages[d.id];
                const status = avg >= 8 ? ' Healthy' : avg >= 6 ? ' Moderate' : ' Critical';
                summary += `${d.name}: ${avg}/9 - ${status}\n`;
            });
            
            navigator.clipboard.writeText(summary).then(() => {
                showToastMessage(' Summary copied to clipboard');
            });
        }
        
        function showToastMessage(message) {
            const toast = document.createElement('div');
            toast.style.cssText = 'position:fixed;top:80px;right:24px;background:var(--green);color:white;padding:16px 24px;border-radius:4px;z-index:3000;font-weight:600;';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }
        
        // Add keyboard support for Guru modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('guru-modal').classList.contains('active')) {
                validateGuruCode();
            }
            if (e.key === 'Escape') {
                closeGuruModal();
                closeGuruMode();
            }
        });
    </script>
</body>
</html>
